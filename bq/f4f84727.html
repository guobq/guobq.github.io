<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="httprunner3.x"><meta name="keywords" content="httprunner"><meta name="author" content="bq,undefined"><meta name="copyright" content="bq"><title>httprunner3.x【bq's notes】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"8ICB0LL54F","apiKey":"b6e01221a0e1bdb34d69e088b9bd39d8","indexName":"blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: {},
  valine: {"appId":"8xUuEcUoXahLwm69LVK1eumF-gzGzoHsz","appKey":"NDF5dcJsxuEHHBOLlda7Y07b"},
}</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="bq's notes" type="application/atom+xml">
</head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#httprunner"><span class="toc-number">1.</span> <span class="toc-text">httprunner</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ENV-prepare"><span class="toc-number">1.1.</span> <span class="toc-text">ENV prepare</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#create-project"><span class="toc-number">1.2.</span> <span class="toc-text">create project</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%84%E4%B8%AA%E7%9B%AE%E5%BD%95%E4%BB%A3%E8%A1%A8%E7%9A%84%E5%90%AB%E4%B9%89%EF%BC%9A"><span class="toc-number">1.2.1.</span> <span class="toc-text">各个目录代表的含义：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">执行方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#har%E6%96%87%E4%BB%B6%E5%BD%95%E5%88%B6%E5%8F%8A%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.3.</span> <span class="toc-text">har文件录制及转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.</span> <span class="toc-text">测试用例结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#chain-call"><span class="toc-number">1.4.1.</span> <span class="toc-text">chain call</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#config"><span class="toc-number">1.4.2.</span> <span class="toc-text">config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#name%EF%BC%88%E5%BF%85%E5%A1%AB%EF%BC%89"><span class="toc-number">1.4.3.</span> <span class="toc-text">name（必填）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#base-url%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-number">1.4.4.</span> <span class="toc-text">base_url（可选）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#variables%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-number">1.4.5.</span> <span class="toc-text">variables（可选）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#verify-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-number">1.4.6.</span> <span class="toc-text">verify （可选）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#export-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-number">1.4.7.</span> <span class="toc-text">export （可选）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RunRequest%EF%BC%88%E5%90%8D%E7%A7%B0%EF%BC%89"><span class="toc-number">1.4.8.</span> <span class="toc-text">RunRequest（名称）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#method%EF%BC%88url%EF%BC%89"><span class="toc-number">1.4.9.</span> <span class="toc-text">method（url）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#extract%EF%BC%88%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96%EF%BC%89"><span class="toc-number">1.4.10.</span> <span class="toc-text">extract（数据提取）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RunTestCase%EF%BC%88%E5%90%8D%E7%A7%B0%EF%BC%89"><span class="toc-number">1.4.11.</span> <span class="toc-text">RunTestCase（名称）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#env%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.</span> <span class="toc-text">.env文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debugtalk-py"><span class="toc-number">1.6.</span> <span class="toc-text">debugtalk.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setup%E5%92%8Cteardown%E5%8F%8Ahook"><span class="toc-number">1.7.</span> <span class="toc-text">setup和teardown及hook</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB%E7%BA%A7%E5%88%AB%E7%9A%84setup%E5%92%8Cteardown"><span class="toc-number">1.7.1.</span> <span class="toc-text">测试类级别的setup和teardown</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%AD%A5%E9%AA%A4%E5%89%8D%E5%90%8E%E7%9A%84setup%E5%92%8Cteardown"><span class="toc-number">1.7.2.</span> <span class="toc-text">测试步骤前后的setup和teardown</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.8.</span> <span class="toc-text">参数化数据驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E8%A1%A8"><span class="toc-number">1.8.1.</span> <span class="toc-text">列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debugtalk-py%E7%9A%84%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.2.</span> <span class="toc-text">debugtalk.py的回调函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8csv%E6%96%87%E4%BB%B6"><span class="toc-number">1.8.3.</span> <span class="toc-text">使用csv文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A"><span class="toc-number">1.9.</span> <span class="toc-text">测试报告</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pytest-html"><span class="toc-number">1.9.1.</span> <span class="toc-text">pytest-html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#allure"><span class="toc-number">1.9.2.</span> <span class="toc-text">allure</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E3%80%81XML%E6%B6%88%E6%81%AF%E6%94%AF%E6%8C%81%E3%80%81XML%E6%A0%BC%E5%BC%8F%E6%96%AD%E8%A8%80"><span class="toc-number">1.10.</span> <span class="toc-text">调试、XML消息支持、XML格式断言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF"><span class="toc-number">1.10.1.</span> <span class="toc-text">添加调试信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XML%E6%B6%88%E6%81%AF%E6%94%AF%E6%8C%81"><span class="toc-number">1.10.2.</span> <span class="toc-text">XML消息支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xml%E6%8A%A5%E6%96%87%E6%96%AD%E8%A8%80%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.10.3.</span> <span class="toc-text">xml报文断言实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9A%E5%B0%86xml%E6%8A%A5%E6%96%87%E5%86%85%E5%AE%B9%E4%BD%9C%E4%B8%BA%E6%95%B4%E4%BD%93%E8%BF%9B%E8%A1%8C%E6%96%AD%E8%A8%80%E6%93%8D%E4%BD%9C"><span class="toc-number">1.10.3.1.</span> <span class="toc-text">方案一：将xml报文内容作为整体进行断言操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9A%E5%B0%86xml%E6%8A%A5%E6%96%87%E5%86%85%E5%AE%B9%E8%BD%AC%E4%B8%BAjson%E6%A0%BC%E5%BC%8F%EF%BC%8C%E5%86%8D%E5%B0%86%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E8%B5%8B%E5%80%BC%E4%B8%BA%E8%BD%AC%E5%8C%96%E5%90%8E%E7%9A%84json%EF%BC%8C%E6%9C%80%E5%90%8E%E8%BF%9B%E8%A1%8Cjson%E6%A0%BC%E5%BC%8F%E6%96%AD%E8%A8%80%E3%80%82"><span class="toc-number">1.10.3.2.</span> <span class="toc-text">方案二：将xml报文内容转为json格式，再将返回结果赋值为转化后的json，最后进行json格式断言。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#questions"><span class="toc-number">1.11.</span> <span class="toc-text">questions</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">bq</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/guobq" target="_blank">GitHub<i class="icon-dot bg-color6"></i></a><a class="links-button button-hover" href="mailto:2278220079@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color4"></i></a><a class="links-button button-hover" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2278220079&amp;site=qq&amp;menu=yes" target="_blank">QQ<i class="icon-dot bg-color9"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">78</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">80</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">25</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">bq's notes</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">httprunner3.x</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2020-09-18 | 更新于 2021-04-11</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/">Test</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/automation/">automation</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/httprunner/">httprunner</a></div></div></div><div class="main-content"><h2 id="httprunner"><a href="#httprunner" class="headerlink" title="httprunner"></a>httprunner</h2><p>相关：python，pytest，allure，locust，requests，git</p>
<h3 id="ENV-prepare"><a href="#ENV-prepare" class="headerlink" title="ENV prepare"></a>ENV prepare</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pip install httprunner -i https://pypi.douban.com/simple</span><br><span class="line">hrun -V #查看版本</span><br><span class="line">httprunner --help #查看帮助</span><br><span class="line"><span class="meta">#</span><span class="bash">positional arguments:&#123;run,startproject,har2case,make&#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">run Make HttpRunner testcases and run with pytest.运行httprunner文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">startproject Create a new project with template structure.创建httprunner项目结构</span></span><br><span class="line"><span class="meta">#</span><span class="bash">har2case Convert HAR(HTTP Archive) to YAML/JSON testcases <span class="keyword">for</span> HttpRunner.转换har文件为yml文件或者json文件或者pytest文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">make Convert YAML/JSON testcases to pytest cases. 转换yml或json文件为pytest文件</span></span><br></pre></td></tr></table></figure>

<h3 id="create-project"><a href="#create-project" class="headerlink" title="create project"></a>create project</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">cmd到项目文件下执行:</span></span><br><span class="line">httprunner startproject interfacedemo#interfacedemo为接口项目名称</span><br></pre></td></tr></table></figure>

<h4 id="各个目录代表的含义："><a href="#各个目录代表的含义：" class="headerlink" title="各个目录代表的含义："></a><strong>各个目录代表的含义：</strong></h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- debugtalk.py 放置在项目根目录下（类似pytest的conftest文件）</span><br><span class="line">- .env 放置在项目根目录下，可以用于存放一些环境变量</span><br><span class="line">- reports 文件夹：存储 HTML 测试报告</span><br><span class="line">- testcases 用于存放测试用例</span><br><span class="line">- har 可以存放录制导出的.har文件</span><br><span class="line">- .gitignore 设置上传到git时需要忽略那些文件信息</span><br></pre></td></tr></table></figure>

<h4 id="执行方式"><a href="#执行方式" class="headerlink" title="执行方式"></a><strong>执行方式</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、hrun interfaceDemo</span><br><span class="line"><span class="meta">#</span><span class="bash">命令等价于httprunner run interfaceDemo，其中先进行httprunner make json/yml，会将json/yml文件先转换为pytest文件，之后再执行hrun(httprunner run)，如果pytest文件是已经存在的（你直接编写的pytest文件，而不是yml或者json），httprunner会直接运行你的pytest脚本，不需要进行转换，官方推荐：直接使用pytest脚本编写</span></span><br><span class="line"><span class="meta">#</span><span class="bash">在tacecases目录下生成py文件，生成的py文件会加上_test后缀，如果yml或者json文件有修改，需要再次http make scriptPath一下，或者直接修改py文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">生成了logs日志文件，每一个yml都会对应生成一个日志文件如下，每一个testcase脚本都会又要给唯一的id，对应了日志文件的文件名：</span></span><br><span class="line">2、pytest interfaceDemo</span><br><span class="line"><span class="meta">#</span><span class="bash">前提，已经使用hrun interfaceDemo生成了yml或json对应的pytest文件，否则不生效</span></span><br></pre></td></tr></table></figure>

<h3 id="har文件录制及转换"><a href="#har文件录制及转换" class="headerlink" title="har文件录制及转换"></a>har文件录制及转换</h3><p><img src="https://raw.githubusercontent.com/guobq/mysource/master/PictureBed/httprunner%E8%84%9A%E6%9C%AC%E8%BD%AC%E6%8D%A2.png" alt="httprunner脚本转换"></p>
<p>工具：Fiddler，Charles，Chrome等</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">har2case har_demo.har -2j#生成json文件命令</span><br><span class="line">har2case har_demo.har -2y#生成yml文件命令</span><br><span class="line">har2case har_demo.json/har_demo.yml#转换为py文件</span><br><span class="line"><span class="meta">#</span><span class="bash">可以使用:hrun har_demo_test.py/har_demo.json/har_demo.yml运行脚本</span></span><br><span class="line"><span class="meta">#</span><span class="bash">使用pytest har_demo_test.py只能运行py文件，不能运行yml或者json</span></span><br></pre></td></tr></table></figure>

<h3 id="测试用例结构"><a href="#测试用例结构" class="headerlink" title="测试用例结构"></a>测试用例结构</h3><p>每个测试用例都是的子类HttpRunner，并且必须具有两个类属性：config和teststeps。<br>配置：配置测试用例级别设置，其中包括base_url，verify，variables，export。<br>teststeps：teststep（List[Step]）的列表，每个步骤都对应一个API请求或另一个测试用例引用调用。此外，variables/ extract/ validate/ hooks机制支持，可制作十分复杂的测试方案，可以参数传递、参数提取、断言、以及其他hook机制，可以自定义钩子函数，也支持pytest和、locust的相关操作，例如：我们可以增加一个pytest.ini文件，在其中进行测试用例目录检索的操作等</p>
<h4 id="chain-call"><a href="#chain-call" class="headerlink" title="chain call"></a>chain call</h4><p>就是IDEA的api代码自动补全</p>
<h4 id="config"><a href="#config" class="headerlink" title="config"></a>config</h4><p>每个测试用例都应该有一个config部分，您可以在其中配置测试用例级别的设置。</p>
<h4 id="name（必填）"><a href="#name（必填）" class="headerlink" title="name（必填）"></a>name（必填）</h4><p>指定测试用例名称。这将显示在执行日志和测试报告中</p>
<h4 id="base-url（可选）"><a href="#base-url（可选）" class="headerlink" title="base_url（可选）"></a>base_url（可选）</h4><p>指定SUT的通用架构和主机部分，例如<a target="_blank" rel="noopener" href="https://postman-echo.com.如果base_url指定,则teststep中的url只能设置相对路径部分.如果要在不同的sut环境之间切换,这将特别有用./">https://postman-echo.com。如果base_url指定，则teststep中的url只能设置相对路径部分。如果要在不同的SUT环境之间切换，这将特别有用。</a></p>
<h4 id="variables（可选）"><a href="#variables（可选）" class="headerlink" title="variables（可选）"></a>variables（可选）</h4><p>指定测试用例的公共变量。每个测试步骤都可以引用未在步骤变量中设置的配置变量。换句话说，步骤变量比配置变量具有更高的优先级。</p>
<h4 id="verify-（可选）"><a href="#verify-（可选）" class="headerlink" title="verify （可选）"></a>verify （可选）</h4><p>指定是否验证服务器的TLS证书。如果我们想记录测试用例执行的HTTP流量，这将特别有用，因为如果没有设置verify或将其设置为True，则会发生SSLError。<br>SSLError（SSLCertVerificationError（1，’[SSL：CERTIFICATE_VERIFY_FAILED]证书验证失败：证书链中的自签名证书（_ssl.c：1076）’）</p>
<h4 id="export-（可选）"><a href="#export-（可选）" class="headerlink" title="export （可选）"></a>export （可选）</h4><p>指定导出的测试用例会话变量。将每个测试用例视为一个黑盒，config variables是输入部分，而config export是输出部分。特别是，当一个测试用例在另一个测试用例的步骤中被引用，并且将被提取一些会话变量以在后续测试步骤中使用时，则提取的会话变量应在配置export部分中进行配置。将测试用例的某些变量指定为全局变量。（PS：不配置export在另一个引用类中进行该类的变量调用时，直接export也是可以的，最好还是配置一下）</p>
<p><img src="https://raw.githubusercontent.com/guobq/mysource/master/PictureBed/HR%E7%94%A8%E4%BE%8B%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB.png"></p>
<p>一个测试套件testsuite，套件中会有很多的测试用例testcase，testcase之间可以相互引用teststep，通过with_jmespath进行参数的提取，通过call引用其他测试用例类，然后通过export引用其他测试用例的变量。teststeps中会有很多step，也就是常说的测试步骤，一个step中只有RunRequest或者RunTestCase，step的先后顺序，有step的前后控制，由step所处的位置由上到下执行</p>
<h4 id="RunRequest（名称）"><a href="#RunRequest（名称）" class="headerlink" title="RunRequest（名称）"></a>RunRequest（名称）</h4><p>RunRequest 在一个步骤中用于向API发出请求，并对响应进行一些提取或验证。<br>.nameRunRequest 的参数用于指定测试步骤名称，该名称将显示在执行日志和测试报告中。<br>.with_variables<br>指定测试步骤变量。每个步骤的变量都是独立的，因此，如果要在多个步骤中共享变量，则应在配置变量中定义变量。此外，步骤变量将覆盖配置变量中具有相同名称的变量。（PS:注意参数传递的格式使用**{}，使用关键字参数解包的方式进行参数传递给with_variables），参数引用使用”$变量名”，如果是函数引用使用”${函数名()}”</p>
<h4 id="method（url）"><a href="#method（url）" class="headerlink" title="method（url）"></a>method（url）</h4><p>指定HTTP方法和SUT的URL。这些对应于method和url参数requests.request。<br>如果base_url在config中设置，则url只能设置相对路径部分。如果在Config中设置了baseurl，method中只能设置相对路径，可选参数为get/post/put/delete/等。<br>.with_params<br>指定请求网址的查询字符串。这对应于的params参数requests.request。<br>.with_headers<br>为请求指定HTTP标头。这对应于的headers参数requests.request。<br>.with_cookies<br>指定HTTP请求cookie。这对应于的cookies参数requests.request。<br>.with_data<br>指定HTTP请求正文。这对应于的data参数requests.request。<br>.with_json<br>在json中指定HTTP请求正文。这对应于的json参数requests.request。</p>
<h4 id="extract（数据提取）"><a href="#extract（数据提取）" class="headerlink" title="extract（数据提取）"></a>extract（数据提取）</h4><p>.WITH_JMESPATH<br>使用jmespath提取JSON响应主体。<br>with_jmespath（jmes_path：文字，var_name：文字）<br>jmes_path：jmespath表达式，有关更多详细信息，请参考JMESPath教程<br>var_name：存储提取值的变量名，可以在后续测试步骤中引用它<br>validate<br>.ASSERT_XXX<br>使用jmespath提取JSON响应主体并使用期望值进行验证。<br>assert_XXX（jmes_path：文本，期望值：任何，消息：文本=“”）<br>jmes_path：jmespath表达式，有关更多详细信息，请参考JMESPath教程<br>Expected_value：指定的期望值，变量或函数引用也可以在此处使用<br>消息（可选）：用于指示断言错误的原因</p>
<h4 id="RunTestCase（名称）"><a href="#RunTestCase（名称）" class="headerlink" title="RunTestCase（名称）"></a>RunTestCase（名称）</h4><p>RunTestCase 在一个步骤中用于引用另一个测试用例调用。<br>.name<br>RunTestCase 的参数用于指定测试步骤名称，该名称将显示在执行日志和测试报告中。<br>.with_variables<br>指定测试步骤变量。每个步骤的变量都是独立的，因此，如果要在多个步骤中共享变量，则应在配置变量中定义变量。此外，步骤变量将覆盖配置变量中具有相同名称的变量。<br>.call<br>指定引用的测试用例类。你在引用另一个测试用例的step中的参数时，需要先指定引用的测试用例类<br>.export<br>指定会话变量名称以从引用的测试用例中导出。导出的变量可以通过后续测试步骤step进行引用。导出的是step中的jmespath提取的变量，export之后，这个变量是全局变量，但是不能再confg中进行设置，因为测试类的引用是在step中进行的，而类的初始化是先初始化config，然后初始化teststeps，所以参数的传递在step之间</p>
<h3 id="env文件"><a href="#env文件" class="headerlink" title=".env文件"></a>.env文件</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、httprunner脚手架会默认创建创建.env文件，将需要设置为环境变量或全局变量的值，存储在env中</span><br><span class="line">2、使用$&#123;ENV(变量名)&#125;调用环境变量</span><br></pre></td></tr></table></figure>

<p>针对环境变量为列表信息的可以先设置为字符串，再进行字符串转列表操作</p>
<p>例如服务器连接（ip|port|user|pwd）：192.168.xxx.xxx|22|admin|admin</p>
<p>代码实现时，将字符串按“|”来进行切割，将结果保存在列表中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_file_to_service</span>(<span class="params">serviceInfo, local_path, remote_path</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param serviceInfo: 服务器信息格式：ip|port|user|pwd</span></span><br><span class="line"><span class="string">    :param local_path: 本地路径</span></span><br><span class="line"><span class="string">    :param remote_path: 远程路径</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    info = serviceInfo.split(<span class="string">&quot;|&quot;</span>)</span><br><span class="line">    t = paramiko.Transport(info[<span class="number">0</span>], int(info[<span class="number">1</span>]))</span><br><span class="line">    t.connect(username=info[<span class="number">2</span>], password=info[<span class="number">3</span>])</span><br><span class="line">    sftp = paramiko.SFTPClient.from_transport(t)</span><br><span class="line">    sftp.put(local_path, remote_path)  <span class="comment"># 上传文件到远程机</span></span><br><span class="line">    sftp.close()</span><br></pre></td></tr></table></figure>

<h3 id="debugtalk-py"><a href="#debugtalk-py" class="headerlink" title="debugtalk.py"></a>debugtalk.py</h3><p>debugtalk.py和pytest的conftest.py文件区别：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conftest.py文件中的定义对当前同级目录下及同级目录下的子目录下的脚本生效，而debugtalk.py按照脚手架的默认生成，只对同级目录testcases目录下的脚本生效，如果需要在testcase下面进行脚本的细分，创建新的模块目录，然后在里面添加测试脚本，是不生效的。</span><br></pre></td></tr></table></figure>

<p>debugtalk主要进行一些公共函数方法的编写例如常用的获取token、获取cookie，或者数据清理，环境初始化等操作，都可以放在debugtalk中。</p>
<p>将脚本中的方法引用到其他处，格式”${方法名}”，即能实现参数化</p>
<h3 id="setup和teardown及hook"><a href="#setup和teardown及hook" class="headerlink" title="setup和teardown及hook"></a>setup和teardown及hook</h3><p>httprunner的setup和teardown可以在yml或者json文件中定义(建议py文件中)</p>
<p>httprunner有两种setup和teardown的定义方式，一个是测试类级别，一个是测试步骤级别的定义。</p>
<h4 id="测试类级别的setup和teardown"><a href="#测试类级别的setup和teardown" class="headerlink" title="测试类级别的setup和teardown"></a>测试类级别的setup和teardown</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/user/bin/env python  </span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">self</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown</span>(<span class="params">self</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#结果为：</span></span><br><span class="line"><span class="comment">#Process finished with exit code 0  </span></span><br><span class="line"><span class="comment">#运行于测试用例之前  </span></span><br><span class="line"><span class="comment">#PASSED [100%]... </span></span><br><span class="line"><span class="comment">#运行于测试用例之后  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/user/bin/env python  </span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line">         </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#上面两种写法在unittest和pytest中是不一样的，setup_class是运行于测试类的前面，setup是运行与每个测试方法的前面，在httprunner貌似不区分这两个方法。</span></span><br></pre></td></tr></table></figure>

<h4 id="测试步骤前后的setup和teardown"><a href="#测试步骤前后的setup和teardown" class="headerlink" title="测试步骤前后的setup和teardown"></a>测试步骤前后的setup和teardown</h4><p>在debugtalk.py中写hook_up和hook_teardown</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_up</span>():</span>  </span><br><span class="line">    print(<span class="string">&quot;前置操作：setup!&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_down</span>(<span class="params">response=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;后置操作：teardown!&quot;</span>)  </span><br><span class="line">    <span class="keyword">if</span> response:  </span><br><span class="line">        print(response)  </span><br><span class="line">        response.status_code = <span class="number">300</span>  </span><br></pre></td></tr></table></figure>

<p>在demo_baidu_request_test.py中调用debugtalk的两个hook方法，使用setup_hook()和teardown_hook()来加载我们自定义的hook：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .setup_hook(<span class="string">&quot;$&#123;hook_up()&#125;&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .teardown_hook(<span class="string">&quot;$&#123;hook_down()&#125;&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#运行结果：</span></span><br><span class="line"><span class="comment">#Process finished with exit code 0  </span></span><br><span class="line"><span class="comment">#运行于测试用例之前  </span></span><br><span class="line"><span class="comment">#PASSED [100%]前置操作：setup!  </span></span><br><span class="line"><span class="comment">#后置操作：teardown!  </span></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="comment">#运行于测试用例之后  </span></span><br></pre></td></tr></table></figure>

<p>既然是hook方法，那么肯定是会集成一些内置的钩子，满足特殊的要求所使用的。<br>setup_hooks:在测试步骤前执行，先调用setup_hooks()内的函数。可以传入 $request 参数，可以对请求进行预处理或者修改，修改请求参数<br>teardown_hooks:在测试步骤执行后，先调用teardown()内的函数，可以传入$response参数，可以对返回值进行处理<br>先在debugtalk.py中定义两个方法，输出一下后面获取的request和response.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_up</span>(<span class="params">request=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;输出request:&#123;&#125;&quot;</span>.format(request))  </span><br><span class="line">    print(<span class="string">&quot;前置操作：setup!&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_down</span>(<span class="params">response=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;输出response:&#123;&#125;&quot;</span>.format(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;%s:%s&#x27;</span> % item <span class="keyword">for</span> item <span class="keyword">in</span> response.__dict__.items()])))  </span><br><span class="line">    print(<span class="string">&quot;后置操作：teardown!&quot;</span>)  </span><br></pre></td></tr></table></figure>

<p>在demo_baidu_request_test.py文件中调用这两个hook，然后传递参数$request和$response。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .setup_hook(<span class="string">&quot;$&#123;hook_up($request)&#125;&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .teardown_hook(<span class="string">&quot;$&#123;hook_down($response)&#125;&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#结果如下：</span></span><br><span class="line"><span class="comment">#Process finished with exit code 0  </span></span><br><span class="line"><span class="comment">#运行于测试用例之前  </span></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="comment">#前置操作：setup!  </span></span><br><span class="line"><span class="comment">#resp_obj:&lt;Response [200]&gt;  </span></span><br><span class="line"><span class="comment">#validation_results:&#123;&#125;  </span></span><br><span class="line"><span class="comment">#后置操作：teardown!  </span></span><br></pre></td></tr></table></figure>

<p>传入的是一个request和response对象，可以对传入的request和response对象进行操作,修改resquest和response传入和返回的值，完成复杂的业务要求。<br>改变一下debugtalk.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_up</span>(<span class="params">request=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;输出request:&#123;&#125;&quot;</span>.format(request))  </span><br><span class="line">    print(<span class="string">&quot;前置操作：setup!&quot;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request:  </span><br><span class="line">        request[<span class="string">&quot;params&quot;</span>][<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;888888&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_down</span>(<span class="params">response=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;输出response:&#123;&#125;&quot;</span>.format(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;%s:%s&#x27;</span> % item <span class="keyword">for</span> item <span class="keyword">in</span> response.__dict__.items()])))  </span><br><span class="line">    print(<span class="string">&quot;后置操作：teardown!&quot;</span>)  </span><br><span class="line">    <span class="keyword">if</span> response:  </span><br><span class="line">        response.status_code = <span class="number">404</span>  </span><br></pre></td></tr></table></figure>

<p>修改了传入的setp的密码为“888888”，修改了step返回的状态码为404，看一下调用情况：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .variables(  </span><br><span class="line">            **&#123;  </span><br><span class="line">                <span class="string">&quot;username&quot;</span>: <span class="string">&quot;123456&quot;</span>  </span><br><span class="line">            &#125;  </span><br><span class="line">        )  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .setup_hook(<span class="string">&quot;$&#123;hook_up($request)&#125;&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .with_params(**&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$&#123;username&#125;&quot;</span>&#125;)  </span><br><span class="line">            .teardown_hook(<span class="string">&quot;$&#123;hook_down($response)&#125;&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#执行结果：</span></span><br><span class="line"><span class="comment">#test_start </span></span><br><span class="line"><span class="comment">#运行于测试用例之前  </span></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="comment">#前置操作：setup!  </span></span><br><span class="line"><span class="comment">#输出response:resp_obj:&lt;Response [200]&gt;  </span></span><br><span class="line"><span class="comment">#validation_results:&#123;&#125;  </span></span><br><span class="line"><span class="comment">#后置操作：teardown  </span></span><br><span class="line"><span class="comment">#method   : GET  </span></span><br><span class="line"><span class="comment">#url      : https://www.baidu.com/?username=888888  </span></span><br><span class="line"><span class="comment">#httprunner.exceptions.ValidationFailure: assert status_code equal 200(int)  ==&gt; fail  </span></span><br><span class="line"><span class="comment">#check_item: status_code  </span></span><br><span class="line"><span class="comment">#check_value: 404(int)  </span></span><br><span class="line"><span class="comment">#assert_method: equal  </span></span><br><span class="line"><span class="comment">#expect_value: 200(int)  </span></span><br><span class="line"><span class="comment">#可以看到断言是失败的，设置的成功断言状态码是200，传入的request中的username开始是123456，截获请求参数后更改为了888888。在实际应用中，可以对于传入账号密码等进行加密，或者对于返回值的格式等进行解码操作</span></span><br></pre></td></tr></table></figure>

<h3 id="参数化数据驱动"><a href="#参数化数据驱动" class="headerlink" title="参数化数据驱动"></a>参数化数据驱动</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">支持三种入参，返回一个列表：</span><br><span class="line">1、列表：[&quot;iOS/10.1&quot;, &quot;iOS/10.2&quot;, &quot;iOS/10.3&quot;]</span><br><span class="line">2、Parameterize类的回调，例如csv：$&#123;parameterize(account.csv)&#125;</span><br><span class="line">3、debugtalk.py的回调，$&#123;gen_app_version()&#125;</span><br><span class="line">在使用参数化之前，首先要导入pytest包，和httprunner的Parameters这个类</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> Parameters  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(&quot;param&quot;, Parameters(  </span></span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: [<span class="number">111</span>, <span class="number">222</span>, <span class="number">333</span>]&#125;  </span><br><span class="line">    ))  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_start</span>(<span class="params">self, param</span>):</span>  </span><br><span class="line">        super().test_start(param)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .variables(  </span><br><span class="line">            **&#123;  </span><br><span class="line">                <span class="string">&quot;username&quot;</span>: <span class="string">&quot;$&#123;get_username()&#125;&quot;</span>  </span><br><span class="line">            &#125;  </span><br><span class="line">        )  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .with_params(**&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$username&quot;</span>&#125;)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br></pre></td></tr></table></figure>

<p>pytest.mark.parametrize()会先将param作为一个动态参数，传递给param，然后由httprunner在进行参数化，httprunner在pytest的parametrize上封装了一层，增加了csv及debugtalk.py参数化的支持。</p>
<h4 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> Parameters  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(&quot;param&quot;, Parameters(  </span></span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: [<span class="number">111</span>, <span class="number">222</span>, <span class="number">333</span>]&#125;  </span><br><span class="line">    ))  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_start</span>(<span class="params">self, param</span>):</span>  </span><br><span class="line">        super().test_start(param)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .variables(  </span><br><span class="line">            **&#123;  </span><br><span class="line">                <span class="string">&quot;username&quot;</span>: <span class="string">&quot;$&#123;get_username()&#125;&quot;</span>  </span><br><span class="line">            &#125;  </span><br><span class="line">        )  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .with_params(**&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$username&quot;</span>&#125;)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br></pre></td></tr></table></figure>

<h4 id="debugtalk-py的回调函数"><a href="#debugtalk-py的回调函数" class="headerlink" title="debugtalk.py的回调函数"></a>debugtalk.py的回调函数</h4><p>在debugtalk.py中定义一个函数，返回列表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_username</span>():</span>  </span><br><span class="line">    <span class="keyword">return</span> [  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;111111&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;222222&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;333333&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;444444&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;555555&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;666666&quot;</span>&#125;,  </span><br><span class="line">    ]  </span><br></pre></td></tr></table></figure>

<p>在xx_test.py文件调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> Parameters  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(&quot;param&quot;, Parameters(  </span></span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$&#123;get_username()&#125;&quot;</span>&#125;  </span><br><span class="line">    ))  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_start</span>(<span class="params">self, param</span>):</span>  </span><br><span class="line">        super().test_start(param)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .with_params(**&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$username&quot;</span>&#125;)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br></pre></td></tr></table></figure>

<h4 id="使用csv文件"><a href="#使用csv文件" class="headerlink" title="使用csv文件"></a>使用csv文件</h4><p>1.csv文件中的title要为变量名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name,pwd</span><br><span class="line">name1,123</span><br><span class="line">name2,123</span><br></pre></td></tr></table></figure>

<p>2.csv映射的时候，参数名要以“-”分割，name和pwd使用的-进行分割</p>
<p>3.csv的路径要使用相对路径，不支持绝对路径不支持\符号的路径</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(&quot;param&quot;, Parameters(  </span></span><br><span class="line">     &#123;<span class="string">&quot;name-pwd&quot;</span>: <span class="string">&quot;$&#123;parametrize(testdata/namepwd.csv)&#125;&quot;</span>&#125;  </span><br><span class="line"> )) </span><br></pre></td></tr></table></figure>

<h3 id="测试报告"><a href="#测试报告" class="headerlink" title="测试报告"></a>测试报告</h3><h4 id="pytest-html"><a href="#pytest-html" class="headerlink" title="pytest-html"></a>pytest-html</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest-html#安装pytest-html插件</span><br><span class="line">hrun testcasesPath --html=path/report.html</span><br></pre></td></tr></table></figure>

<h4 id="allure"><a href="#allure" class="headerlink" title="allure"></a>allure</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">生成测试结果</span></span><br><span class="line">hrun testcasePath --alluredir=resultPath#测试结果存放路径</span><br><span class="line"><span class="meta">#</span><span class="bash">第一种方式，会生成静态资源文件，通过静态资源index.html地址访问</span></span><br><span class="line">allure generate resultPath -o reportPath</span><br><span class="line"><span class="meta">#</span><span class="bash">第二种方式，不会生成静态资源文件，启动一个web服务，提供ip和port在线访问</span></span><br><span class="line">allure serve resultPath</span><br></pre></td></tr></table></figure>

<h3 id="调试、XML消息支持、XML格式断言"><a href="#调试、XML消息支持、XML格式断言" class="headerlink" title="调试、XML消息支持、XML格式断言"></a>调试、XML消息支持、XML格式断言</h3><h4 id="添加调试信息"><a href="#添加调试信息" class="headerlink" title="添加调试信息"></a>添加调试信息</h4><p>在调试代码时，引入loguru打印日志(httprunner源码中作者使用loguru.logger进行日志打印)</p>
<p>可在debugtalk.py中沿用此模块来进行日志打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from loguru import logger</span><br></pre></td></tr></table></figure>

<p>使用print未必会打印，但是使用logger.info会将信息打印到命令行中，格式为: logger.info()</p>
<h4 id="XML消息支持"><a href="#XML消息支持" class="headerlink" title="XML消息支持"></a>XML消息支持</h4><p>将报文内容写在文档中，用例中调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将报文内容保存在.xml文件中，使用get_file_std（）方法读取文件内容返回</span></span><br><span class="line">最后将变量m_encoder付给data关键字</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_file_std</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="comment"># 获取当前脚本所在文件夹路径</span></span><br><span class="line">    curPath = os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">    print(<span class="string">&#x27;curPath&#x27;</span>, curPath)</span><br><span class="line">    <span class="comment"># 获取文件路径</span></span><br><span class="line">    fileurl = os.path.join(curPath, <span class="string">&quot;messages/%s&quot;</span> % filename)</span><br><span class="line">    print(<span class="string">&#x27;fileurl&#x27;</span>, fileurl)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileurl, <span class="string">&quot;r+&quot;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br></pre></td></tr></table></figure>



<h4 id="xml报文断言实现"><a href="#xml报文断言实现" class="headerlink" title="xml报文断言实现"></a>xml报文断言实现</h4><h5 id="方案一：将xml报文内容作为整体进行断言操作"><a href="#方案一：将xml报文内容作为整体进行断言操作" class="headerlink" title="方案一：将xml报文内容作为整体进行断言操作"></a>方案一：将xml报文内容作为整体进行断言操作</h5><p>( 定义变量：xmlinfo <BatchNotifyRsp><ResultCode>0</ResultCode><ResultDec></ResultDec></BatchNotifyRsp>)</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">config:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;batch user order sync interface&quot;</span></span><br><span class="line">    <span class="attr">base_url:</span> <span class="string">$&#123;ENV(49_HOST)&#125;</span></span><br><span class="line">    <span class="attr">verify:</span> <span class="literal">False</span></span><br><span class="line">    <span class="attr">variables:</span></span><br><span class="line">        <span class="attr">localpath:</span> <span class="string">&quot;D:\\work\\wy_only\\CtIntfDemo\\data\\update.txt&quot;</span></span><br><span class="line">        <span class="attr">remotepath:</span> <span class="string">&quot;/iot/Filesync/User_20201027150556_7169060048412345.txt&quot;</span></span><br><span class="line">        <span class="attr">49serv:</span> <span class="string">$&#123;ENV(49_SERV)&#125;</span></span><br><span class="line">        <span class="attr">oracle1:</span> <span class="string">$&#123;ENV(oracle11)&#125;</span></span><br><span class="line">        <span class="attr">xmlinfo:</span> <span class="string">&#x27;&lt;BatchNotifyRsp&gt;&lt;ResultCode&gt;0&lt;/ResultCode&gt;&lt;ResultDec&gt;&lt;/ResultDec&gt;&lt;/BatchNotifyRsp&gt;&#x27;</span></span><br><span class="line"><span class="number">12345678910</span></span><br></pre></td></tr></table></figure>

<p>断言：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attr">variables:</span></span><br><span class="line">        <span class="attr">file_path:</span> <span class="string">&quot;data\\batchOrderSync.xml&quot;</span></span><br><span class="line">        <span class="attr">m_encoder:</span> <span class="string">$&#123;get_file_std($file_path)&#125;</span></span><br><span class="line">        <span class="attr">retbody:</span> <span class="string">$&#123;str_bytes($xmlinfo)&#125;</span> <span class="comment"># 将str格式转化为bytes格式</span></span><br><span class="line">    <span class="attr">request:</span></span><br><span class="line">        <span class="attr">method:</span> <span class="string">POST</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">/Sync/BatchOperatorNotify/User</span></span><br><span class="line">        <span class="attr">headers:</span></span><br><span class="line">            <span class="attr">Content-Type:</span> <span class="string">application/xml</span></span><br><span class="line">        <span class="attr">data:</span> <span class="string">$m_encoder</span></span><br><span class="line">    <span class="attr">validate:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]</span><br><span class="line">        <span class="comment"># - eq: [body.BatchNotifyRsp.ResultCode, &quot;0&quot;]</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">body</span>, <span class="string">$retbody</span>]   <span class="comment">#直接断言返回xml整体</span></span><br><span class="line"><span class="number">1234567891011121314</span></span><br></pre></td></tr></table></figure>

<p>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_bytes</span>(<span class="params">str</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param str:字符串</span></span><br><span class="line"><span class="string">    :return:bytes类型</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bytes(str, encoding=<span class="string">&quot;utf8&quot;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="方案二：将xml报文内容转为json格式，再将返回结果赋值为转化后的json，最后进行json格式断言。"><a href="#方案二：将xml报文内容转为json格式，再将返回结果赋值为转化后的json，最后进行json格式断言。" class="headerlink" title="方案二：将xml报文内容转为json格式，再将返回结果赋值为转化后的json，最后进行json格式断言。"></a>方案二：将xml报文内容转为json格式，再将返回结果赋值为转化后的json，最后进行json格式断言。</h5><p>teardown_hooks机制，会在断言之前执行</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">teardown_hooks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$&#123;teardown_hook_xml_json($response)&#125;</span></span><br></pre></td></tr></table></figure>

<p>断言：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">validate:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]</span><br><span class="line">    <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">body.BatchNotifyRsp.ResultCode</span>, <span class="string">&quot;0&quot;</span>]</span><br><span class="line">    <span class="comment">#- eq: [body, $retbody]   #直接断言返回xml整体</span></span><br></pre></td></tr></table></figure>

<p>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xml_to_json</span>(<span class="params">xml_str</span>):</span></span><br><span class="line">    <span class="comment"># parse是的xml解析器</span></span><br><span class="line">    xml_parse = xmltodict.parse(xml_str)</span><br><span class="line">    <span class="comment"># json库dumps()是将dict转化成json格式,loads()是将json转化成dict格式。</span></span><br><span class="line">    <span class="comment"># dumps()方法的ident=1,格式化json</span></span><br><span class="line">    json_str = json.dumps(xml_parse, indent=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> json_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">teardown_hook_xml_json</span>(<span class="params">response</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将xml报文内容转化为json格式内容,并将返回内容替换成json格式</span></span><br><span class="line"><span class="string">    :param response: 返回报文对象</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    jsoninfo = xml_to_json(response.body)</span><br><span class="line">    response.body = json.loads(jsoninfo)</span><br></pre></td></tr></table></figure>

<h3 id="questions"><a href="#questions" class="headerlink" title="questions"></a>questions</h3><p>1.查看log时，或者报错信息是中文时，显示unicode编码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可以在httprunner/client.py 文件中添加 ensure_ascii=False修改以下代码如下：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_print</span>(<span class="params">req_or_resp, r_type</span>):</span></span><br><span class="line">msg = <span class="string">f&quot;\n================== <span class="subst">&#123;r_type&#125;</span> details ==================\n&quot;</span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> req_or_resp.dict().items():</span><br><span class="line"><span class="keyword">if</span> isinstance(value, dict):</span><br><span class="line">value = json.dumps(value, indent=<span class="number">4</span>, ensure_ascii=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>2.cookies管理</p>
<p>httprunner继承requests,可自动管理</p>
<p>403 Forbidden,一般是网站处于安全考虑，缺少cookies导致(有些接口需要用到cookies，cookie没关联起来)</p>
<p>隐藏参数csrfmiddlewaretoken</p>
<p>csrfmiddlewaretoken参数是html页面上的隐藏参数,是为了防止跨域伪造请求。每次刷新页面都会自动变，需要先把此参数提取出来，动态关联到请求参数的body里面</p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">bq</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://guobq.github.io/bq/f4f84727.html">https://guobq.github.io/bq/f4f84727.html</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://guobq.github.io">bq's notes</a>！</span></div></div><div class="post-copyright valine" id="comments-container"><script src="//unpkg.com/valine@1.4.14/dist/Valine.min.js"></script><script>let arr = location.href.split('/#more')[0].split('/');
let title = arr[arr.length - 1];
if (title === '') {
    title = arr[arr.length - 2];
}
var flag = false;
var gitFun = function () {
    try {
        var valineObj = window.GLOBAL_CONFIG.valine;
        new Valine({
            el: "#comments-container",
            ...valineObj
        });
        flag = true;
    } catch (e) {
        flag = false;
    }
}
var setIn = setInterval(() => {
    if (!flag) {
        gitFun();
    } else {
        clearInterval(setIn);
    }
}, 200);</script></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/bq/3d268e98.html"><i class="fas fa-angle-left">&nbsp;</i><span>Selenium&amp;appium grid</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/bq/ea66df61.html"><span>docker使用</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2020 ～ 2022 By bq</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>