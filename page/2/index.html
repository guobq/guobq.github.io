<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords"><meta name="author" content="bq,undefined"><meta name="copyright" content="bq"><title>【bq's notes】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"8ICB0LL54F","apiKey":"b6e01221a0e1bdb34d69e088b9bd39d8","indexName":"blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: {},
  valine: {"appId":"8xUuEcUoXahLwm69LVK1eumF-gzGzoHsz","appKey":"NDF5dcJsxuEHHBOLlda7Y07b"},
}</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="bq's notes" type="application/atom+xml">
</head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="author-info"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">bq</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/guobq" target="_blank">GitHub<i class="icon-dot bg-color3"></i></a><a class="links-button button-hover" href="mailto:2278220079@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color4"></i></a><a class="links-button button-hover" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2278220079&amp;site=qq&amp;menu=yes" target="_blank">QQ<i class="icon-dot bg-color5"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">74</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">74</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">25</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">bq's notes</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><div id="recent-posts"><!-- each post in page.posts.sort('date', -1).limit(10).toArray()--><!-- config中配置按照什么排序--><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/5ae0fba5.html">GitHub-Page搭建个人博客</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-06-03</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E9%80%9A%E7%94%A8/">通用</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E9%80%9A%E7%94%A8/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/">服务搭建</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/GitHubPage/">GitHubPage</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Hexo/">Hexo</a></div></div><div class="post-content"><div class="main-content content"><h3 id="安装，建立和启动Hexo"><a href="#安装，建立和启动Hexo" class="headerlink" title="安装，建立和启动Hexo"></a>安装，建立和启动Hexo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 全局安装hexo-cli</span></span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装插件</span></span><br><span class="line">npm install hexo-renderer-ejs --save</span><br><span class="line">npm install hexo-renderer-stylus --save</span><br><span class="line">npm install hexo-renderer-marked --save</span><br><span class="line"><span class="meta">#</span><span class="bash"> 建立Hexo工程，并<span class="built_in">cd</span>到博客目录里，安装相应的包</span></span><br><span class="line">hexo init blog</span><br><span class="line">cd blog</span><br><span class="line">npm install</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成静态文件，public文件夹</span></span><br><span class="line">hexo generate</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动Hexo</span></span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>

<h3 id="修改主题（Fan）"><a href="#修改主题（Fan）" class="headerlink" title="修改主题（Fan）"></a>修改主题（Fan）</h3><p><a target="_blank" rel="noopener" href="https://hexo.io/themes/">https://hexo.io/themes/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/fan-lv/Fan">https://github.com/fan-lv/Fan</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拉取选择的主题</span></span><br><span class="line">git clone https://github.com/fan-lv/Fan.git themes/Fan</span><br><span class="line"><span class="meta">#</span><span class="bash"> _config.yml中修改主题</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Extensions</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Plugins: https://hexo.io/plugins/</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Themes: https://hexo.io/themes/</span></span></span><br><span class="line">theme: Fan</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新主题</span></span><br><span class="line">cd themes\Fan</span><br><span class="line">git pull</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装依赖</span></span><br><span class="line">npm install --save hexo-renderer-pug hexo-renderer-stylus</span><br><span class="line">npm install --save hexo-generator-feed hexo-generator-sitemap hexo-generator-archive hexo-browsersync</span><br></pre></td></tr></table></figure>

<h4 id="文章（Markdown-文件）设置"><a href="#文章（Markdown-文件）设置" class="headerlink" title="文章（Markdown 文件）设置"></a>文章（Markdown 文件）设置</h4><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 标题</span><br><span class="line">title: xxx</span><br><span class="line"># 作者</span><br><span class="line">author: xxx</span><br><span class="line"># 标签</span><br><span class="line">tags:</span><br><span class="line">  - xxx</span><br><span class="line"># 分类</span><br><span class="line">categories:</span><br><span class="line">  - xxx</span><br><span class="line">date: xxx</span><br><span class="line"># 支持置顶</span><br><span class="line">top: 1</span><br></pre></td></tr></table></figure>

<h3 id="部署到GitHub"><a href="#部署到GitHub" class="headerlink" title="部署到GitHub"></a>部署到GitHub</h3><p>打开blog目录下的_config.yml配置文件，改如下配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span></span><br><span class="line">    <span class="attr">github:</span> <span class="string">https://github.com/guobq/guobq.github.io</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装插件</span></span><br><span class="line">npm install --save hexo-deployer-git</span><br><span class="line"><span class="meta">#</span><span class="bash"> 部署到github</span></span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>

<h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><p>_config.yml配置</p>
<hr>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># comments</span></span><br><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="attr">gitment:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">&#x27;guobq&#x27;</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="string">&#x27;https://github.com/guobq/k8s&#x27;</span></span><br><span class="line">    <span class="attr">client_id:</span> <span class="string">&#x27;a91e9ec426714f54a397&#x27;</span></span><br><span class="line">    <span class="attr">client_secret:</span> <span class="string">&#x27;614ed1b11be02220c9a08cd1e8c3fda3195d60a4&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 可以自由配置 valine 的其他配置项（参考链接 https://valine.js.org/configuration.html)</span></span><br><span class="line">  <span class="attr">valine:</span></span><br><span class="line">    <span class="attr">appId:</span> <span class="string">&#x27;8xUuEcUoXahLwm69LVK1eumF-gzGzoHsz&#x27;</span></span><br><span class="line">    <span class="attr">appKey:</span> <span class="string">&#x27;NDF5dcJsxuEHHBOLlda7Y07b&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="Gitment"><a href="#Gitment" class="headerlink" title="Gitment"></a><a target="_blank" rel="noopener" href="https://github.com/imsun/gitment">Gitment</a></h4><p>获取client_id,client_secret</p>
<p>1.打开<a target="_blank" rel="noopener" href="https://github.com/settings/developers">https://github.com/settings/developers</a></p>
<p>2.New OAuth APP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Homepage URL:</span><br><span class="line">https://guobq.github.io/</span><br><span class="line"><span class="meta">#</span><span class="bash">开发就是本地的地址加端口，生产就不用说了</span></span><br><span class="line">Authorization callback URL：</span><br><span class="line">https://guobq.github.io/</span><br><span class="line"><span class="meta">#</span><span class="bash">开发就是本地的回调，这个概念不理解的话去学一下Oauth</span></span><br></pre></td></tr></table></figure>

<p>3.生成Client ID，CLient Secret</p>
<h4 id="Valine"><a href="#Valine" class="headerlink" title="Valine"></a><a target="_blank" rel="noopener" href="https://valine.js.org/">Valine</a></h4><p>从<code>LeanCloud</code>的应用中得到的<code>appId</code>.</p>
<p><a target="_blank" rel="noopener" href="https://leancloud.cn/">https://leancloud.cn/</a></p>
<p>登录或注册 LeanCloud, 进入控制台后点击左下角创建应用</p>
<p>进入刚刚创建的应用，选择左下角的设置&gt;应用Key，然后就能看到你的APP ID和APP Key了</p>
<h3 id="Algolia-search"><a href="#Algolia-search" class="headerlink" title="Algolia_search"></a>Algolia_search</h3><p>注册 <a target="_blank" rel="noopener" href="https://www.algolia.com/users/sign_in">Algolia账户</a>，创建新的 Index，记下 <code>index name</code></p>
<p>安装扩展</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-algolia --save</span><br></pre></td></tr></table></figure>

<p>修改 Algolia 搜索 ACL（访问控制列表） 默认的 <code>Search-Only API Key</code> 不能修改，需要在 <code>All API Keys</code> -&gt; <code>New API Key</code></p>
<p>勾选 ACLs: <code>search</code> <code>addObject</code> <code>deleteObject</code> <code>listIndexes</code> <code>deletelndex</code></p>
<p>执行安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export HEXO_ALGOLIA_INDEXING_KEY=New API Key</span><br><span class="line"><span class="meta">#</span><span class="bash"> 刷新索引</span></span><br><span class="line">hexo algolia</span><br></pre></td></tr></table></figure>

<p>获取 Key，更新站点根目录配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">algolia:</span></span><br><span class="line">  <span class="attr">applicationID:</span> <span class="string">&#x27;Application ID&#x27;</span></span><br><span class="line">  <span class="attr">apiKey:</span> <span class="string">&#x27;New API Key&#x27;</span></span><br><span class="line">  <span class="attr">indexName:</span> <span class="string">&#x27;index name&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># algolia</span></span><br><span class="line"><span class="attr">algolia:</span></span><br><span class="line">  <span class="attr">applicationID:</span> <span class="string">&#x27;8ICB0LL54F&#x27;</span></span><br><span class="line">  <span class="attr">apiKey:</span> <span class="string">&#x27;b6e01221a0e1bdb34d69e088b9bd39d8&#x27;</span></span><br><span class="line">  <span class="attr">indexName:</span> <span class="string">&#x27;blog&#x27;</span></span><br></pre></td></tr></table></figure>

<p>主题配置下开启 Algolia_search</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">algolia_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hits:</span></span><br><span class="line">    <span class="attr">per_page:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h3 id="打开分类，标签，关于"><a href="#打开分类，标签，关于" class="headerlink" title="打开分类，标签，关于"></a>打开分类，标签，关于</h3><p>切换到主目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo new page categories</span><br><span class="line">hexo new page tags</span><br><span class="line">hexo new page about</span><br></pre></td></tr></table></figure>

<p>./source/categories,tags,about目录下，会生成index.md</p>
<p>categories/index.md</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">layout:</span> <span class="string">layout_single</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">分类</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2020-09-09</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>tags/index.md</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2020-09-09</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">&quot;tags&quot;</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>about/index.md</p>
<p>自定义</p>
<h3 id="生成永久文章链接"><a href="#生成永久文章链接" class="headerlink" title="生成永久文章链接"></a>生成永久文章链接</h3><h4 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h4><p>插件源码地址: <a target="_blank" rel="noopener" href="https://github.com/rozbo/hexo-abbrlink">hexo-abbrlink</a> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可能会出现依赖，依据提示安装即可。</p>
</blockquote>
<h4 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h4><p>修改博客根目录配置文件 <code>_config.yml</code> 的 <code>permalink</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># permalink: :year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">p/:abbrlink.html</span>  <span class="comment"># p 是自定义的前缀</span></span><br><span class="line"><span class="attr">abbrlink:</span></span><br><span class="line">    <span class="attr">alg:</span> <span class="string">crc32</span>   <span class="comment">#算法： crc16(default) and crc32</span></span><br><span class="line">    <span class="attr">rep:</span> <span class="string">hex</span>     <span class="comment">#进制： dec(default) and hex</span></span><br></pre></td></tr></table></figure>

<p>不同算法和进制生成不同的格式：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">crc16 &amp; hex</span><br><span class="line">66c8</span><br><span class="line">crc16 &amp; dec</span><br><span class="line">65535</span><br><span class="line">crc32 &amp; hex</span><br><span class="line">8ddf18fb</span><br><span class="line">crc32 &amp; dec</span><br><span class="line">123456789</span><br></pre></td></tr></table></figure>

<h4 id="3-验证"><a href="#3-验证" class="headerlink" title="3.验证"></a>3.验证</h4><p>先清理下本地的文件 <code>hexo clean</code>，然后重新生成 <code>hexo g</code>，启动博客 <code>hexo s</code>。该插件会在每篇文章的开头增加内容：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abbrlink: df27ccfb</span><br></pre></td></tr></table></figure>

<p>这个字符串就是这篇文章的唯一标识，无论修改标题还是发布文章都不会改变。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://hexo.io/">https://hexo.io/</a></p>
<p><a target="_blank" rel="noopener" href="https://valine.js.org/">https://valine.js.org/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011116672/article/details/51160742">https://blog.csdn.net/u011116672/article/details/51160742</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43870742/article/details/102004099">https://blog.csdn.net/weixin_43870742/article/details/102004099</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42595443/article/details/82466442?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.edu_weight&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.edu_weight">https://blog.csdn.net/qq_42595443/article/details/82466442?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.edu_weight&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.edu_weight</a></p>
<p><a target="_blank" rel="noopener" href="https://www.dazhuanlan.com/2019/11/03/5dbeaac238b49/?__cf_chl_jschl_tk__=53c7e61c6cb87976027ff79b485e7bc157d29a40-1602087870-0-AUbOpkBUnGVqTiIPnn1W8j-mk4RiIIk1-VQEcAnnN1JciituXSOs_o7b-405C3oJBLMXE-meOUymlyBwQ0f4jh7Cy3lAeQEblSmezSNOjfACC7iyIoYjP_ZSr0g2rpL-u8U6LeS93EJquJ0jbM7CYuks8Uk2vE6dnkMjTmaEA4peQcMPbE75lqujsB1Ax6lBPIa4dVYUD4iMoLE2BN6E-jVmJqJOb3X4SbtKRwSXMZP0-cPVpi46NOcvpSLgIr5vDKxDJHUd6PPgbsxy6Q-ywtneDqnTqZofb4wjdp-_FJaw_Z-cOWTnRWeFLEngd33Olg">https://www.dazhuanlan.com/2019/11/03/5dbeaac238b49/?__cf_chl_jschl_tk__=53c7e61c6cb87976027ff79b485e7bc157d29a40-1602087870-0-AUbOpkBUnGVqTiIPnn1W8j-mk4RiIIk1-VQEcAnnN1JciituXSOs_o7b-405C3oJBLMXE-meOUymlyBwQ0f4jh7Cy3lAeQEblSmezSNOjfACC7iyIoYjP_ZSr0g2rpL-u8U6LeS93EJquJ0jbM7CYuks8Uk2vE6dnkMjTmaEA4peQcMPbE75lqujsB1Ax6lBPIa4dVYUD4iMoLE2BN6E-jVmJqJOb3X4SbtKRwSXMZP0-cPVpi46NOcvpSLgIr5vDKxDJHUd6PPgbsxy6Q-ywtneDqnTqZofb4wjdp-_FJaw_Z-cOWTnRWeFLEngd33Olg</a></p>
</div></div><a class="button-hover more" href="/bq/5ae0fba5.html#more">阅读全文</a></div><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/3b90fe4c.html">效能与质量</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-04-11</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E4%BD%93%E7%B3%BB/">体系</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E4%BD%93%E7%B3%BB/%E8%BF%87%E7%A8%8B%E8%B4%A8%E9%87%8F/">过程质量</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/cmmi/">cmmi</a></div></div><div class="post-content"><div class="main-content content"><h2 id="效能与质量"><a href="#效能与质量" class="headerlink" title="效能与质量"></a>效能与质量</h2><h3 id="研发阶段和效率价值金字塔"><a href="#研发阶段和效率价值金字塔" class="headerlink" title="研发阶段和效率价值金字塔"></a>研发阶段和效率价值金字塔</h3><blockquote>
<p>需求调研和评审&gt;技术方案设计和评审&gt;研发&gt;测试</p>
</blockquote>
<h2 id="度量"><a href="#度量" class="headerlink" title="度量"></a>度量</h2><h4 id="考核千行代码Bug率的问题"><a href="#考核千行代码Bug率的问题" class="headerlink" title="考核千行代码Bug率的问题"></a>考核千行代码Bug率的问题</h4><blockquote>
<p>代码行数&lt;&gt;价值</p>
</blockquote>
<p>考核标准：Bug率数值越小就说明越好-&gt;尽量增大代码行数</p>
<p>考核阶段：Bug率的数据主要产出在研发阶段的后期，及提交测试后产出bug数-&gt;从项目的研发阶段和效率价值金字塔来看，其对项目的整体质量方面更多的聚焦在微观层面问题，整体的质量的影响范围会较小。</p>
<h4 id="更合理的度量质量"><a href="#更合理的度量质量" class="headerlink" title="更合理的度量质量"></a>更合理的度量质量</h4><ol>
<li><p>需求的评审</p>
</li>
<li><p>架构设计方案评审</p>
</li>
<li><p>代码模块设计，包的依赖的规划，接口的设计的review</p>
</li>
<li><p>代码的review的机制</p>
</li>
<li><p>测试用例评审</p>
</li>
<li><p>使用代码检测工具，自动发现问题</p>
</li>
</ol>
<blockquote>
<p>过程评审是最有效也是成本最低的质量和效率保证和提升的手段。另外，过程评审还是迅速提高新人能力及其成果物的规范性的一个有效手段。</p>
</blockquote>
<h5 id="系统质量是要靠上游工程做出来的"><a href="#系统质量是要靠上游工程做出来的" class="headerlink" title="系统质量是要靠上游工程做出来的"></a>系统质量是要靠上游工程做出来的</h5><p>上游的工作质量会更为重要，上游的问题的影响范围将更广，对效率和价值的影响更大，应该是我们重点关注的地方。仅仅依赖下游工程(种种测试)来把质量关，是十分低效，而且代价是非常昂贵的。</p>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><h3 id="需求管理"><a href="#需求管理" class="headerlink" title="需求管理"></a>需求管理</h3><blockquote>
<p>1.需求要被管理，被管理的意思又有两层：一是需求要被确认，二是要控制需求变更</p>
<p>2.需求要用来指导下游的工作产品，如：计划、设计、测试等</p>
</blockquote>
<h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><blockquote>
<p>1.因为项目进度赶等原因，在很多需求还没有明确情况下，便开始开发的工作。<br>2.开始客户只能提出模糊的需求，客户喜欢先让你做个东西给他看，然后他才可能逐渐提出真正的需求，而需求调研人员，对此没有什么好的处理办法。<br>3.客户以种种原因不签需求，项目组在不签需求的情况下，便开始开发工作。<br>4.客户不承认之前提出来的需求，项目组又不能得失客户，项目成员苦不堪言。<br>5.需求经常变化，无法控制。<br>6.设计、代码与需求不对应，特别是需求变更时，不知道应该修改哪部分，也不知道会有哪些影响</p>
</blockquote>
<h4 id="优秀的需求管理要素："><a href="#优秀的需求管理要素：" class="headerlink" title="优秀的需求管理要素："></a>优秀的需求管理要素：</h4><blockquote>
<p>开发者应该理解需求</p>
<p>通过客户确认（记录）</p>
<p>需求变更管理（记录确认，影响清单确认）</p>
<p>需求双向跟踪维护（纵向：上下游工作产品之间的跟踪关系。横向：需求与需求之间的关系、设计与设计之前的关系、代码与代码之间的关系等）</p>
<p>需求与下游工作产品差异识别（需求变更时：双向跟踪表影响内容同步修改；编写写或者修改计划、设计、代码、测试计划、测试用例等需求下游工作产品时：要与需求保持一致）</p>
</blockquote>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p><strong>工具赋能：</strong>需求管理平台&lt;-&gt;aido</p>
<h3 id="需求开发"><a href="#需求开发" class="headerlink" title="需求开发"></a>需求开发</h3><blockquote>
<p>用系统的方法获取真正的全面的能实现的需求</p>
</blockquote>
<h4 id="常见问题-1"><a href="#常见问题-1" class="headerlink" title="常见问题"></a>常见问题</h4><blockquote>
<p>没有把握好客户需求，直接进入软件的细节，去讨论要做什么功能，界面要怎样设计去了，而忘记了软件的根本目的是为了解决什么问题。</p>
</blockquote>
<p>明确客户需求后，就应该把客户需求转变成产品需求和产品组件需求，客户需求一般都是比较高层次的，而且描述也会比较简单，不能作为日后验收的标准，我们需要对软件的规格进行说明。一般来说，我们写的软件规格说明书都会包含产品需求和产品组件需求的。我们导出产品需求和产品组件需求的时候，要注意产品需求和产品组件需求，必须和客户需求对应起来，通常是多对多的关系。为什么要对应起来？我们要保证，软件的每一个界面，每一个功能都是有用的，都是“源自”客户需求的，这样才能保证我们做的事情都是正确的事情，防止被不相干的事情干扰。</p>
<p>客户需求</p>
<blockquote>
<p>可以理解成客户为什么要做本系统，要解决什么问题，客户对系统有怎样的期望，希望能具备一些怎样的特点，简单的说，就是客户的需要是什么。</p>
</blockquote>
<p>产品需求</p>
<blockquote>
<p>是能满足客户需求，并对软件产品规格进行了详细描述的需求，软件设计师可以根据产品需求进行设计、编码等工作。</p>
</blockquote>
<p>产品组件需求</p>
<blockquote>
<p>是对产品需求的进一步细化，产品可能会分割成几个子系统、几个部分，每个子系统每部分要具备怎样的功能、要具备怎样的性能、接口要求等，这些可以认为是产品组件需求。</p>
</blockquote>
<p>另外一个角度，需求可以分为功能性需求和非功能性需求两类，功能性需求就是系统具备怎样的功能，能做什么事情，而非功能性需求就是指系统要具备怎样的性能、安全级别等方面的要求。客户需求、产品需求和产品组件需求，都会包含功能需求和非功能需求。</p>
<h4 id="优秀的需求开发要素："><a href="#优秀的需求开发要素：" class="headerlink" title="优秀的需求开发要素："></a>优秀的需求开发要素：</h4><p>干系人的需要、期望、约束和接口要求被收集并转化为客户需求</p>
<blockquote>
<p>让客户能完整无遗漏准确地表达出他的想法：（原型、图示、类比、问卷）系统的目标、范围、解决什么问题、希望系统具备怎样的一些特性，满足一些什么接口要求和约束条件等</p>
<p>把客户原始的需求信息整理成正式的客户需求：通常会包括对系统目标、范围、解决问题、软件特性、接口要求等有详细的描述。</p>
</blockquote>
<p>客户需求是精确和详细的，以用来开发产品需求和产品组件需求</p>
<blockquote>
<p>产品和产品组件需求：对软件规格的描述，详细描述软件与用户是怎样交互的，用户需要输入什么，系统输出等都会比较详细描述出来。可做验收标准<br>分配需求给每一个产品组件：所有的需求应该与设计的产品组件对应，保证需求驱动后续的设计工作，同时也保证设计都是为需求服务</p>
<p>定义接口需求：包括系统与第三方的系统的接口要求，也包括系统本身各组件、各子系统、各部分之间的接口要求</p>
</blockquote>
<p>需求被分析和确认，并定义出具体的功能性需求</p>
<blockquote>
<p>操作场景与功能定义：描述出具体需求的操作场景、上下文，具体的操作步骤，对功能的详细描述等。通常我们可以通过序列图等来表达这些内容</p>
<p>分析需求：准确性、全面性、可实现性，平衡约束条件，确保需求符合最终的使用场景要求。通常是通过需求评审</p>
</blockquote>
<h2 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h2><h3 id="技术方案"><a href="#技术方案" class="headerlink" title="技术方案"></a>技术方案</h3><h4 id="常见问题-2"><a href="#常见问题-2" class="headerlink" title="常见问题"></a>常见问题</h4><blockquote>
<p>1)无设计文档<br>2)有设计文档，但形同虚设<br>3)设计时没有考虑可以重用以前项目或者第三方的代码或组件<br>4)没有用需求来驱动设计<br>5)设计没有考虑多过一个的方案<br>6)没有考虑清楚设计的原则和标准<br>7)设计的弹性不够、架构落后？<br>8)代码与设计脱节？<br>9)到处都是面条式代码</p>
</blockquote>
<h4 id="优秀的技术方案要素："><a href="#优秀的技术方案要素：" class="headerlink" title="优秀的技术方案要素："></a>优秀的技术方案要素：</h4><p>从候选方案中选择产品或者产品组件的解决方案</p>
<blockquote>
<p>先考虑好我们设计方案的选择标准，并找出可能的候选方案</p>
<p>对产品的规格进行详细的表述，操作概念、场景、环境、操作模式和操作状态等</p>
<p>根据选择标准选出最佳方案</p>
</blockquote>
<p>开发产品或者产品组件设计</p>
<blockquote>
<p>概要设计：建立产品功能和框架，包含产品组成区块、产品组件界定、系统状态与模式、主要的内外部接口和界面设计（功能模块设计、数据库设计包括逻辑设计和物理设计及安全性能设计、模块接口和界面设计）</p>
<p>详细设计：完整定义产品组件的结构和功能，详细描述实现方法、算法</p>
<p>建立和维护技术数据包：（需求、设计资料等）为开发者提供开发产品或组件的综合性描述，以及产品架构描述、分配需求、产品组件的描述、产品相关生命周期过程描述、关键产品特性、必需的物理特征和约束、接口需求、用于确保实现需求的验证准则等。</p>
<p>设计合适的产品组件接口：考虑外部接口和内部接口；与原来系统的关系；</p>
<p>产品组件开发、购买或者重用评估：技术状况</p>
</blockquote>
<p>实施产品组件的设计</p>
<blockquote>
<p>编码：适当的标准与准则，走查，单元测试</p>
<p>用户文档：用户手册、安装手册、管理员手册、在线帮助等</p>
</blockquote>
<h3 id="产品集成"><a href="#产品集成" class="headerlink" title="产品集成"></a>产品集成</h3><h4 id="常见问题-3"><a href="#常见问题-3" class="headerlink" title="常见问题"></a>常见问题</h4><blockquote>
<p>时序</p>
</blockquote>
<h4 id="优秀的产品集成要素："><a href="#优秀的产品集成要素：" class="headerlink" title="优秀的产品集成要素："></a>优秀的产品集成要素：</h4><p>完成产品集成的准备工作</p>
<blockquote>
<p>建立并维护产品组件的产品集成流程<br>建立并维护产品组件集成与评估标准<br>建立并维护产品组件的确认与交付标准</p>
</blockquote>
<p>确保产品内部与外部的接口是兼容的</p>
<blockquote>
<p>检查接口描述，保证覆盖性和完整性：通常通过评审接口说明。包括产品组件接口，产品集成所有环境的接口（定期）</p>
<p>管理产品和产品组件的内部和外部接口的定义、设计及变更：管理各组件之间的关系，保证组件间保持一致（配置库）</p>
</blockquote>
<p>组合已集成的产品组件，并交付已集成、已验证、已确认的产品</p>
<blockquote>
<p>在产品集成前，确定要集成的产品的产品组件已被确认、并依据其说明执行，并且确定产品集成接口符合接口说明</p>
<p>根据产品集成顺序和相关过程集成产品组件</p>
<p>评估产品组件的接口兼容性</p>
<p>打包组装已集成的产品或组件，并交付给适当的客户</p>
</blockquote>
<h4 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h4><p><strong>工具赋能</strong>：统一环境管理，持续集成，持续交付</p>
</div></div><a class="button-hover more" href="/bq/3b90fe4c.html#more">阅读全文</a></div><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/7e386764.html">idea设置</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-09-19</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E9%80%9A%E7%94%A8/">通用</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E9%80%9A%E7%94%A8/%E5%B7%A5%E5%85%B7%E4%B8%8E%E9%85%8D%E7%BD%AE/">工具与配置</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/idea%E8%AE%BE%E7%BD%AE/">idea设置</a></div></div><div class="post-content"><div class="main-content content"><h3 id="注释中文乱码"><a href="#注释中文乱码" class="headerlink" title="注释中文乱码"></a>注释中文乱码</h3><p>已设置全局编码格式UTF-8，项目编码格式UTF-8，中文不能正常显示<br>如config.properties，里面中文注释显示为utf8字符编码数字<br>解决方法：file-&gt;settings-&gt;editor-&gt;file encodings<br>勾选（Transparent native-to-ascii converstion）</p>
</div></div><a class="button-hover more" href="/bq/7e386764.html#more">阅读全文</a></div><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/67576fd0.html">python selenium</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-04-11</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/">Test</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/automation/">automation</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/python/">python</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/selenium/">selenium</a></div></div><div class="post-content"><div class="main-content content"><h2 id="python-selenium"><a href="#python-selenium" class="headerlink" title="python selenium"></a>python selenium</h2><h3 id="弹出框处理的实现"><a href="#弹出框处理的实现" class="headerlink" title="弹出框处理的实现"></a>弹出框处理的实现</h3><p>弹出框有两种：页面弹出框（可定位元素能操作）、Windows弹出框（不能直接定位）</p>
<h4 id="一、页面弹出框"><a href="#一、页面弹出框" class="headerlink" title="一、页面弹出框"></a>一、页面弹出框</h4><p>等待弹出框出现之后，定位弹出框，操作其中元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"><span class="comment">#点击百度登录按钮</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;u1&quot;]//a[@name=&quot;tj_login&quot;]&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment">#等待百度登录弹出框中 要出现的元素可见</span></span><br><span class="line">ele_id = <span class="string">&quot;TANGRAM__PSP_10__footerULoginBtn&quot;</span></span><br><span class="line">param = (By.ID,ele_id)</span><br><span class="line"><span class="comment">#元素可见时，再进行后续操作</span></span><br><span class="line">WebDriverWait(driver,<span class="number">10</span>).until(EC.visibility_of_element_located(param))</span><br><span class="line"></span><br><span class="line">driver.find_element_by_id(ele_id).click()</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<h4 id="二、Windows弹出框"><a href="#二、Windows弹出框" class="headerlink" title="二、Windows弹出框"></a><strong>二、Windows弹出框</strong></h4><p>使用 driver.switch_to.alert 切换到Windows弹出框</p>
<p>Alert类提供了一系列操作方法：</p>
<ul>
<li>accept() 确定</li>
<li>dismiss() 取消</li>
<li>text() 获取弹出框里面的内容</li>
<li>send_keys(keysToSend) 输入字符串</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1:定位alert弹出框</span></span><br><span class="line"><span class="comment">#点击页面元素，触发alert弹出框</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;alert&quot;]&#x27;</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"><span class="comment">#等待alert弹出框可见</span></span><br><span class="line">WebDriverWait(driver,<span class="number">20</span>).until(EC.alert_is_present())</span><br><span class="line"></span><br><span class="line"><span class="comment">#从html页面切换到alert弹框 </span></span><br><span class="line">alert = driver.switch_to.alert</span><br><span class="line"><span class="comment">#获取alert的文本内容</span></span><br><span class="line">print(alert.text)</span><br><span class="line"><span class="comment">#接受--选择“确定”</span></span><br><span class="line">alert.accept()</span><br><span class="line"></span><br><span class="line"><span class="comment">#2:定位confirm弹出框</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;confirm&quot;]&#x27;</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">WebDriverWait(driver,<span class="number">20</span>).until(EC.alert_is_present())</span><br><span class="line">alert =driver.switch_to.alert</span><br><span class="line">print(alert.text)</span><br><span class="line"><span class="comment"># 接受--选择“取消”</span></span><br><span class="line">alert.dismiss()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3:定位prompt弹出框</span></span><br><span class="line">driver.find_element_by_id(<span class="string">&quot;prompt&quot;</span>).click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">WebDriverWait(driver,<span class="number">20</span>).until(EC.alert_is_present())</span><br><span class="line">alert =driver.switch_to.alert</span><br><span class="line">alert.send_keys(<span class="string">&quot;jaja&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">print(alert.text)</span><br><span class="line"><span class="comment"># alert.dismiss()</span></span><br><span class="line">alert.accept()</span><br></pre></td></tr></table></figure>

<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><h4 id="input标签-type-file"><a href="#input标签-type-file" class="headerlink" title="input标签(type=file)"></a>input标签(type=file)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;file&#x27;</span>).send_keys(<span class="string">&#x27;./bq.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="非input型上传"><a href="#非input型上传" class="headerlink" title="非input型上传"></a>非input型上传</h4><h5 id="autoit"><a href="#autoit" class="headerlink" title="autoit"></a>autoit</h5><p>AutoIt Windows Info 用于识别Windows控件信息<br>Compile Script to.exe 用于将AutoIt生成 exe 执行文件<br>Run Script 用于执行AutoIt脚本<br>SciTE Script Editor 用于编写AutoIt脚本</p>
<p>1.识别元素，主要是文件名输入框和打开按钮，使用AutoIt Windows Info完成，记录结果如下：<br>文件名输入框的class 为“Edit”，Instance为“1”<br>打开按钮的class 为“Button”，Instance为“1”<br>2.编写脚本，使用SciTE Script Editor，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ControlFocus(&quot;文件上传&quot;, &quot;&quot;,&quot;Edit1&quot;)</span><br><span class="line">WinWait(&quot;[CLASS:#32770]&quot;,&quot;&quot;,10)</span><br><span class="line">ControlSetText(&quot;文件上传&quot;, &quot;&quot;, &quot;Edit1&quot;,&quot;D:bq.jpg&quot;)</span><br><span class="line">Sleep(2000)</span><br><span class="line">ControlClick(&quot;文件上传&quot;, &quot;&quot;,&quot;Button1&quot;);</span><br><span class="line">#注意“文件上传”字样是你点击上传按钮之后弹出的对话框的title</span><br></pre></td></tr></table></figure>
<p>3、验证脚本<br>保证页面的上传对话框打开，然后运行脚本tools&gt;go<br>4、打开Compile Script to.exe工具，将其生成为exe可执行文件<br>5、python脚本中调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">up=self.driver.find_element(<span class="string">&#x27;class name&#x27;</span>,<span class="string">&#x27;avatar-uploader-trigger&#x27;</span>)</span><br><span class="line">up.find_element(<span class="string">&#x27;class name&#x27;</span>,<span class="string">&#x27;ant-btn&#x27;</span>).click()</span><br><span class="line">os.system(<span class="string">&#x27;D:\python_workspace\QiangSEAuto\upload.exe&#x27;</span>)</span><br><span class="line">time.sleep(<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<h5 id="win32gui"><a href="#win32gui" class="headerlink" title="win32gui"></a>win32gui</h5><p>示例网址:<a target="_blank" rel="noopener" href="http://www.sahitest.com/demo/php/fileUpload.htm">http://www.sahitest.com/demo/php/fileUpload.htm</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> win32gui</span><br><span class="line"><span class="keyword">import</span> win32con</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">dr = webdriver.Firefox()</span><br><span class="line">dr.get(<span class="string">&#x27;http://sahitest.com/demo/php/fileUpload.htm&#x27;</span>)</span><br><span class="line">upload = dr.find_element_by_id(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">upload.click()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># win32gui</span></span><br><span class="line">dialog = win32gui.FindWindow(<span class="string">&#x27;#32770&#x27;</span>, <span class="string">u&#x27;文件上传&#x27;</span>) <span class="comment"># 对话框</span></span><br><span class="line">ComboBoxEx32 = win32gui.FindWindowEx(dialog, <span class="number">0</span>, <span class="string">&#x27;ComboBoxEx32&#x27;</span>, <span class="literal">None</span>) </span><br><span class="line">ComboBox = win32gui.FindWindowEx(ComboBoxEx32, <span class="number">0</span>, <span class="string">&#x27;ComboBox&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">Edit = win32gui.FindWindowEx(ComboBox, <span class="number">0</span>, <span class="string">&#x27;Edit&#x27;</span>, <span class="literal">None</span>) <span class="comment"># 上面三句依次寻找对象，直到找到输入框Edit对象的句柄</span></span><br><span class="line">button = win32gui.FindWindowEx(dialog, <span class="number">0</span>, <span class="string">&#x27;Button&#x27;</span>, <span class="literal">None</span>) <span class="comment"># 确定按钮Button</span></span><br><span class="line"></span><br><span class="line">win32gui.SendMessage(Edit, win32con.WM_SETTEXT, <span class="literal">None</span>, <span class="string">&#x27;d:\\baidu.py&#x27;</span>) <span class="comment"># 往输入框输入绝对地址</span></span><br><span class="line">win32gui.SendMessage(dialog, win32con.WM_COMMAND, <span class="number">1</span>, button) <span class="comment"># 按button</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> upload.get_attribute(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">dr.quit()</span><br></pre></td></tr></table></figure>

<p>需要windows窗口、消息查看分析器:小工具：Spy++，也可以用autoIT自带的工具</p>
<p>相关API</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">win32gui.FindWindow(lpClassName=<span class="literal">None</span>, lpWindowName=<span class="literal">None</span>):</span><br><span class="line"><span class="comment">#自顶层窗口开始寻找匹配条件的窗口，并返回这个窗口的句柄。</span></span><br><span class="line"><span class="comment">#lpClassName：类名，在Spy++里能够看到</span></span><br><span class="line"><span class="comment">#lpWindowName：窗口名，标题栏上能看到的名字</span></span><br><span class="line"><span class="comment">#代码示例里我们用来寻找上传窗口，你可以只用其中的一个，用classname定位容易被其他东西干扰，用windowname定位不稳定，不同的上传对话框可能window_name不同，怎么定位取决于你的情况。 </span></span><br><span class="line">win32gui.FindWindowEx(hwndParent=<span class="number">0</span>, hwndChildAfter=<span class="number">0</span>, lpszClass=<span class="literal">None</span>, lpszWindow=<span class="literal">None</span>)</span><br><span class="line"><span class="comment">#搜索类名和窗体名匹配的窗体，并返回这个窗体的句柄。找不到就返回0。</span></span><br><span class="line"><span class="comment">#hwndParent：若不为0，则搜索句柄为hwndParent窗体的子窗体。</span></span><br><span class="line"><span class="comment">#hwndChildAfter：若不为0，则按照z-index的顺序从hwndChildAfter向后开始搜索子窗体，否则从第一个子窗体开始搜索。</span></span><br><span class="line"><span class="comment">#lpClassName：字符型，是窗体的类名，这个可以在Spy++里找到。</span></span><br><span class="line"><span class="comment">#lpWindowName：字符型，是窗口名，也就是标题栏上你能看见的那个标题。</span></span><br><span class="line"><span class="comment">#代码示例里我们用来层层寻找输入框和寻找确定按钮 </span></span><br><span class="line">win32gui.SendMessage(hWnd, Msg, wParam, lParam)</span><br><span class="line"><span class="comment">#hWnd：整型，接收消息的窗体句柄</span></span><br><span class="line"><span class="comment">#Msg：整型，要发送的消息，这些消息都是windows预先定义好的，可以参见系统定义消息（System-Defined Messages）</span></span><br><span class="line"><span class="comment">#wParam：整型，消息的wParam参数</span></span><br><span class="line"><span class="comment">#lParam：整型，消息的lParam参数</span></span><br><span class="line"><span class="comment">#代码示例里我们用来向输入框输入文件地址以及点击确定按钮</span></span><br></pre></td></tr></table></figure>

<h5 id="SendKeys"><a href="#SendKeys" class="headerlink" title="SendKeys"></a>SendKeys</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install SendKeys </span><br></pre></td></tr></table></figure>

<p>通过SendKeys库可以直接向焦点里输入信息，不过要注意在打开窗口是略微加一点等待时间，否则容易第一个字母send不进去（或者你可以在地址之前加一个无用字符，不推荐）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> win32gui</span><br><span class="line"><span class="keyword">import</span> win32con</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">dr = webdriver.Firefox()</span><br><span class="line">dr.get(<span class="string">&#x27;http://sahitest.com/demo/php/fileUpload.htm&#x27;</span>)</span><br><span class="line">upload = dr.find_element_by_id(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">upload.click()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SendKeys</span></span><br><span class="line">SendKeys.SendKeys(<span class="string">&#x27;D:\\baidu.py&#x27;</span>) <span class="comment"># 发送文件地址</span></span><br><span class="line">SendKeys.SendKeys(<span class="string">&quot;&#123;ENTER&#125;&quot;</span>) <span class="comment"># 发送回车键</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> upload.get_attribute(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">dr.quit()</span><br></pre></td></tr></table></figure>

<h5 id="keybd-event"><a href="#keybd-event" class="headerlink" title="keybd_event"></a>keybd_event</h5><p>win32api提供了一个keybd_event()方法模拟按键</p>
<h5 id="多文件"><a href="#多文件" class="headerlink" title="多文件"></a>多文件</h5><p>多文件上传就是在文件路径框里用引号括起单个路径，然后用逗号隔开多个路径，例如：“D:\a.txt” “D:\b.txt”<br>注意：只有多个文件在同一路径下，才能这样用，否则是会失败的</p>
<h3 id="切换iframe"><a href="#切换iframe" class="headerlink" title="切换iframe"></a>切换iframe</h3><h4 id="1-有id，并且唯一，直接写id"><a href="#1-有id，并且唯一，直接写id" class="headerlink" title="1.有id，并且唯一，直接写id"></a>1.有id，并且唯一，直接写id</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to_frame(<span class="string">&quot;x-URS-iframe&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-有name，并且唯一，直接写name"><a href="#2-有name，并且唯一，直接写name" class="headerlink" title="2.有name，并且唯一，直接写name"></a>2.有name，并且唯一，直接写name</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to_frame(<span class="string">&quot;xxxx&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="3-无id，无name-先定位iframe元素"><a href="#3-无id，无name-先定位iframe元素" class="headerlink" title="3.无id，无name,先定位iframe元素"></a>3.无id，无name,先定位iframe元素</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iframe = driver.find_elements_by_tag_name(<span class="string">&quot;iframe&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">driver.switch_to_frame(iframe)</span><br><span class="line">driver.switch_to.frame(driver.find_element_by_xpath(<span class="string">&quot;//iframe[contains(@src,&#x27;myframe&#x27;)]&quot;</span>))</span><br></pre></td></tr></table></figure>
<h4 id="5-从frame中切回主文档-switch-to-default-content"><a href="#5-从frame中切回主文档-switch-to-default-content" class="headerlink" title="5.从frame中切回主文档(switch_to.default_content())"></a>5.从frame中切回主文档(switch_to.default_content())</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to.default_content()</span><br></pre></td></tr></table></figure>

<h4 id="6-嵌套frame的操作-switch-to-parent-frame"><a href="#6-嵌套frame的操作-switch-to-parent-frame" class="headerlink" title="6.嵌套frame的操作(switch_to.parent_frame())"></a>6.嵌套frame的操作(switch_to.parent_frame())</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">&quot;frame1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">&quot;frame2&quot;</span> / &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从主文档切到frame2，一层层切进去</span></span><br><span class="line">driver.switch_to.frame(<span class="string">&quot;frame1&quot;</span>)</span><br><span class="line">driver.switch_to.frame(<span class="string">&quot;frame2&quot;</span>)</span><br><span class="line"><span class="comment">#从frame2再切回frame1，这里selenium给我们提供了一个方法能够从子frame切回到父frame，而不用切回主文档再切进来。</span></span><br><span class="line">driver.switch_to.parent_frame()  <span class="comment"># 如果当前已是主文档，则无效果</span></span><br></pre></td></tr></table></figure>

</div></div><a class="button-hover more" href="/bq/67576fd0.html#more">阅读全文</a></div><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/3d268e98.html">Selenium&amp;appium grid</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-04-11</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/">Test</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/automation/">automation</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/selenium-hub/">selenium hub</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/grid/">grid</a></div></div><div class="post-content"><div class="main-content content"><h3 id="部署selenium-hub与浏览器节点"><a href="#部署selenium-hub与浏览器节点" class="headerlink" title="部署selenium hub与浏览器节点"></a>部署selenium hub与浏览器节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 部署selenium hub （java -jar selenium-server-standalone-3.141.59.jar -role hub）</span></span><br><span class="line">docker run -d -p 4444:4444 --name hub -e GRID_TIMEOUT=0 -e GRID_THROW_ON_CAPABILITY_NOT_PRESENT-true -e GRID_NEW_SESSION_WAIT_TIMEOUT=-1 -e GRID_BROWSER_TIMEOUT=15000 -e GRID_TIMEOUT=30000 -e GRID_CLEAN_UP_CYCLE=30000 selenium/hub:3.141 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 部署node-chrome浏览器节点，debug模式可以通过VNC查看，密码secret（--link hub关联到hub，需同网段）</span></span><br><span class="line">docker run -d -p 5900:5900 --name node -e NODE_MAX_INSTANCES=6 -e NODE_MAX_SESSION=6 -e NODE_REGISTER_CYCLE=5000 -e DBUS_SESSION_BUS_ADDRESS=/dev/null -v /dev/shm:/dev/shm --link hub selenium/node-chrome-debug:3.141 </span><br></pre></td></tr></table></figure>

<h3 id="移动端接入"><a href="#移动端接入" class="headerlink" title="移动端接入"></a>移动端接入</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chen072086/article/details/106503548?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param">https://blog.csdn.net/chen072086/article/details/106503548?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.channel_param</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设备注册到hub</span></span><br><span class="line">cd &#x27;/c/Program Files/Appium/resources/app/node_modules/appium/build/lib&#x27;</span><br><span class="line">node main.js -a 127.0.0.1 -p 4723 -bp 4725 -U 8676-A01-0x3da2c286 --nodeconfig /d/bq/config/dason.json</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置说明</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;capabilities&quot;:</span><br><span class="line">      [</span><br><span class="line">        &#123;</span><br><span class="line">		  &quot;deviceName&quot;: &quot;127.0.0.1:62001&quot;, 	#此为adb devices检测到的设备名</span><br><span class="line">          &quot;version&quot;:&quot;4.4.2&quot;,	#模拟器/真机的系统版本</span><br><span class="line">          &quot;maxInstances&quot;: 1,	#最多的实例个数</span><br><span class="line">          &quot;platform&quot;:&quot;ANDROID&quot;, #测试平台：Android</span><br><span class="line">		  &quot;browserName&quot;: &quot;&quot; 	#测试普通App可置为空，如果是测试浏览器如chrome就可以写上</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">  &quot;configuration&quot;:</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;cleanUpCycle&quot;:2000,</span><br><span class="line">    &quot;timeout&quot;:30000,</span><br><span class="line">    &quot;proxy&quot;: &quot;org.openqa.grid.selenium.proxy.DefaultRemoteProxy&quot;,</span><br><span class="line">    &quot;hub&quot;:&quot;127.0.0.1:4444/grid/register&quot;,  #hub的注册接口地址</span><br><span class="line">    &quot;url&quot;:&quot;http://127.0.0.1:4723/wd/hub&quot;,	#Appium Server的默认访问路径</span><br><span class="line">    &quot;host&quot;: &quot;127.0.0.1&quot;,	#Appium Server的IP地址</span><br><span class="line">    &quot;port&quot;: 4723,	#Appium Server端口号</span><br><span class="line">    &quot;maxSession&quot;: 1,</span><br><span class="line">    &quot;register&quot;: true,</span><br><span class="line">    &quot;registerCycle&quot;: 5000,</span><br><span class="line">    &quot;hubPort&quot;: 4444,	#hub端口号</span><br><span class="line">    &quot;hubHost&quot;: &quot;127.0.0.1&quot;,	#hub IP地址，这里是在本机上启动的，如果是在另外的机器上需要用其外部的IP地址，比如：192.168.1.111这种</span><br><span class="line">    &quot;hubProtocol&quot;: &quot;http&quot;	#协议，默认为http</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置参考</span></span><br><span class="line">&#123;</span><br><span class="line">	&quot;capabilities&quot;: [</span><br><span class="line">		&#123;</span><br><span class="line">			&quot;deviceName&quot;: &quot;8676-A01-0x3da2c286&quot;,</span><br><span class="line">			&quot;version&quot;: &quot;5.1&quot;,</span><br><span class="line">			&quot;maxInstances&quot;: 1,</span><br><span class="line">			&quot;platform&quot;: &quot;ANDROID&quot;,</span><br><span class="line">			&quot;browserName&quot;: &quot;chrome&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	&quot;configuration&quot;: &#123;</span><br><span class="line">		&quot;cleanUpCycle&quot;: 2000,</span><br><span class="line">		&quot;timeout&quot;: 30000,</span><br><span class="line">		&quot;proxy&quot;: &quot;org.openqa.grid.selenium.proxy.DefaultRemoteProxy&quot;,</span><br><span class="line">		&quot;hub&quot;: &quot;http://192.168.0.108:4444/grid/register&quot;,</span><br><span class="line">		&quot;url&quot;: &quot;http://127.0.0.1:4723/wd/hub&quot;,</span><br><span class="line">		&quot;host&quot;: &quot;192.168.0.103&quot;,</span><br><span class="line">		&quot;port&quot;: 4723,</span><br><span class="line">		&quot;maxSession&quot;: 1,</span><br><span class="line">		&quot;register&quot;: true,</span><br><span class="line">		&quot;registerCycle&quot;: 5000,</span><br><span class="line">		&quot;hubPort&quot;: 4444,</span><br><span class="line">		&quot;hubHost&quot;: &quot;192.168.0.108&quot;,</span><br><span class="line">		&quot;hubProtocol&quot;: &quot;http&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></div><a class="button-hover more" href="/bq/3d268e98.html#more">阅读全文</a></div><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/f4f84727.html">httprunner3.x</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-04-11</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/">Test</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/automation/">automation</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/httprunner/">httprunner</a></div></div><div class="post-content"><div class="main-content content"><h2 id="httprunner"><a href="#httprunner" class="headerlink" title="httprunner"></a>httprunner</h2><p>相关：python，pytest，allure，locust，requests，git</p>
<h3 id="ENV-prepare"><a href="#ENV-prepare" class="headerlink" title="ENV prepare"></a>ENV prepare</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pip install httprunner -i https://pypi.douban.com/simple</span><br><span class="line">hrun -V #查看版本</span><br><span class="line">httprunner --help #查看帮助</span><br><span class="line"><span class="meta">#</span><span class="bash">positional arguments:&#123;run,startproject,har2case,make&#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">run Make HttpRunner testcases and run with pytest.运行httprunner文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">startproject Create a new project with template structure.创建httprunner项目结构</span></span><br><span class="line"><span class="meta">#</span><span class="bash">har2case Convert HAR(HTTP Archive) to YAML/JSON testcases <span class="keyword">for</span> HttpRunner.转换har文件为yml文件或者json文件或者pytest文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">make Convert YAML/JSON testcases to pytest cases. 转换yml或json文件为pytest文件</span></span><br></pre></td></tr></table></figure>

<h3 id="create-project"><a href="#create-project" class="headerlink" title="create project"></a>create project</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">cmd到项目文件下执行:</span></span><br><span class="line">httprunner startproject interfacedemo#interfacedemo为接口项目名称</span><br></pre></td></tr></table></figure>

<h4 id="各个目录代表的含义："><a href="#各个目录代表的含义：" class="headerlink" title="各个目录代表的含义："></a><strong>各个目录代表的含义：</strong></h4><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- debugtalk.py 放置在项目根目录下（类似pytest的conftest文件）</span><br><span class="line">- .env 放置在项目根目录下，可以用于存放一些环境变量</span><br><span class="line">- reports 文件夹：存储 HTML 测试报告</span><br><span class="line">- testcases 用于存放测试用例</span><br><span class="line">- har 可以存放录制导出的.har文件</span><br><span class="line">- .gitignore 设置上传到git时需要忽略那些文件信息</span><br></pre></td></tr></table></figure>

<h4 id="执行方式"><a href="#执行方式" class="headerlink" title="执行方式"></a><strong>执行方式</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、hrun interfaceDemo</span><br><span class="line"><span class="meta">#</span><span class="bash">命令等价于httprunner run interfaceDemo，其中先进行httprunner make json/yml，会将json/yml文件先转换为pytest文件，之后再执行hrun(httprunner run)，如果pytest文件是已经存在的（你直接编写的pytest文件，而不是yml或者json），httprunner会直接运行你的pytest脚本，不需要进行转换，官方推荐：直接使用pytest脚本编写</span></span><br><span class="line"><span class="meta">#</span><span class="bash">在tacecases目录下生成py文件，生成的py文件会加上_test后缀，如果yml或者json文件有修改，需要再次http make scriptPath一下，或者直接修改py文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">生成了logs日志文件，每一个yml都会对应生成一个日志文件如下，每一个testcase脚本都会又要给唯一的id，对应了日志文件的文件名：</span></span><br><span class="line">2、pytest interfaceDemo</span><br><span class="line"><span class="meta">#</span><span class="bash">前提，已经使用hrun interfaceDemo生成了yml或json对应的pytest文件，否则不生效</span></span><br></pre></td></tr></table></figure>

<h3 id="har文件录制及转换"><a href="#har文件录制及转换" class="headerlink" title="har文件录制及转换"></a>har文件录制及转换</h3><p><img src="https://raw.githubusercontent.com/guobq/mysource/master/PictureBed/httprunner%E8%84%9A%E6%9C%AC%E8%BD%AC%E6%8D%A2.png" alt="httprunner脚本转换"></p>
<p>工具：Fiddler，Charles，Chrome等</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">har2case har_demo.har -2j#生成json文件命令</span><br><span class="line">har2case har_demo.har -2y#生成yml文件命令</span><br><span class="line">har2case har_demo.json/har_demo.yml#转换为py文件</span><br><span class="line"><span class="meta">#</span><span class="bash">可以使用:hrun har_demo_test.py/har_demo.json/har_demo.yml运行脚本</span></span><br><span class="line"><span class="meta">#</span><span class="bash">使用pytest har_demo_test.py只能运行py文件，不能运行yml或者json</span></span><br></pre></td></tr></table></figure>

<h3 id="测试用例结构"><a href="#测试用例结构" class="headerlink" title="测试用例结构"></a>测试用例结构</h3><p>每个测试用例都是的子类HttpRunner，并且必须具有两个类属性：config和teststeps。<br>配置：配置测试用例级别设置，其中包括base_url，verify，variables，export。<br>teststeps：teststep（List[Step]）的列表，每个步骤都对应一个API请求或另一个测试用例引用调用。此外，variables/ extract/ validate/ hooks机制支持，可制作十分复杂的测试方案，可以参数传递、参数提取、断言、以及其他hook机制，可以自定义钩子函数，也支持pytest和、locust的相关操作，例如：我们可以增加一个pytest.ini文件，在其中进行测试用例目录检索的操作等</p>
<h4 id="chain-call"><a href="#chain-call" class="headerlink" title="chain call"></a>chain call</h4><p>就是IDEA的api代码自动补全</p>
<h4 id="config"><a href="#config" class="headerlink" title="config"></a>config</h4><p>每个测试用例都应该有一个config部分，您可以在其中配置测试用例级别的设置。</p>
<h4 id="name（必填）"><a href="#name（必填）" class="headerlink" title="name（必填）"></a>name（必填）</h4><p>指定测试用例名称。这将显示在执行日志和测试报告中</p>
<h4 id="base-url（可选）"><a href="#base-url（可选）" class="headerlink" title="base_url（可选）"></a>base_url（可选）</h4><p>指定SUT的通用架构和主机部分，例如<a target="_blank" rel="noopener" href="https://postman-echo.com.如果base_url指定,则teststep中的url只能设置相对路径部分.如果要在不同的sut环境之间切换,这将特别有用./">https://postman-echo.com。如果base_url指定，则teststep中的url只能设置相对路径部分。如果要在不同的SUT环境之间切换，这将特别有用。</a></p>
<h4 id="variables（可选）"><a href="#variables（可选）" class="headerlink" title="variables（可选）"></a>variables（可选）</h4><p>指定测试用例的公共变量。每个测试步骤都可以引用未在步骤变量中设置的配置变量。换句话说，步骤变量比配置变量具有更高的优先级。</p>
<h4 id="verify-（可选）"><a href="#verify-（可选）" class="headerlink" title="verify （可选）"></a>verify （可选）</h4><p>指定是否验证服务器的TLS证书。如果我们想记录测试用例执行的HTTP流量，这将特别有用，因为如果没有设置verify或将其设置为True，则会发生SSLError。<br>SSLError（SSLCertVerificationError（1，’[SSL：CERTIFICATE_VERIFY_FAILED]证书验证失败：证书链中的自签名证书（_ssl.c：1076）’）</p>
<h4 id="export-（可选）"><a href="#export-（可选）" class="headerlink" title="export （可选）"></a>export （可选）</h4><p>指定导出的测试用例会话变量。将每个测试用例视为一个黑盒，config variables是输入部分，而config export是输出部分。特别是，当一个测试用例在另一个测试用例的步骤中被引用，并且将被提取一些会话变量以在后续测试步骤中使用时，则提取的会话变量应在配置export部分中进行配置。将测试用例的某些变量指定为全局变量。（PS：不配置export在另一个引用类中进行该类的变量调用时，直接export也是可以的，最好还是配置一下）</p>
<p><img src="https://raw.githubusercontent.com/guobq/mysource/master/PictureBed/HR%E7%94%A8%E4%BE%8B%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB.png"></p>
<p>一个测试套件testsuite，套件中会有很多的测试用例testcase，testcase之间可以相互引用teststep，通过with_jmespath进行参数的提取，通过call引用其他测试用例类，然后通过export引用其他测试用例的变量。teststeps中会有很多step，也就是常说的测试步骤，一个step中只有RunRequest或者RunTestCase，step的先后顺序，有step的前后控制，由step所处的位置由上到下执行</p>
<h4 id="RunRequest（名称）"><a href="#RunRequest（名称）" class="headerlink" title="RunRequest（名称）"></a>RunRequest（名称）</h4><p>RunRequest 在一个步骤中用于向API发出请求，并对响应进行一些提取或验证。<br>.nameRunRequest 的参数用于指定测试步骤名称，该名称将显示在执行日志和测试报告中。<br>.with_variables<br>指定测试步骤变量。每个步骤的变量都是独立的，因此，如果要在多个步骤中共享变量，则应在配置变量中定义变量。此外，步骤变量将覆盖配置变量中具有相同名称的变量。（PS:注意参数传递的格式使用**{}，使用关键字参数解包的方式进行参数传递给with_variables），参数引用使用”$变量名”，如果是函数引用使用”${函数名()}”</p>
<h4 id="method（url）"><a href="#method（url）" class="headerlink" title="method（url）"></a>method（url）</h4><p>指定HTTP方法和SUT的URL。这些对应于method和url参数requests.request。<br>如果base_url在config中设置，则url只能设置相对路径部分。如果在Config中设置了baseurl，method中只能设置相对路径，可选参数为get/post/put/delete/等。<br>.with_params<br>指定请求网址的查询字符串。这对应于的params参数requests.request。<br>.with_headers<br>为请求指定HTTP标头。这对应于的headers参数requests.request。<br>.with_cookies<br>指定HTTP请求cookie。这对应于的cookies参数requests.request。<br>.with_data<br>指定HTTP请求正文。这对应于的data参数requests.request。<br>.with_json<br>在json中指定HTTP请求正文。这对应于的json参数requests.request。</p>
<h4 id="extract（数据提取）"><a href="#extract（数据提取）" class="headerlink" title="extract（数据提取）"></a>extract（数据提取）</h4><p>.WITH_JMESPATH<br>使用jmespath提取JSON响应主体。<br>with_jmespath（jmes_path：文字，var_name：文字）<br>jmes_path：jmespath表达式，有关更多详细信息，请参考JMESPath教程<br>var_name：存储提取值的变量名，可以在后续测试步骤中引用它<br>validate<br>.ASSERT_XXX<br>使用jmespath提取JSON响应主体并使用期望值进行验证。<br>assert_XXX（jmes_path：文本，期望值：任何，消息：文本=“”）<br>jmes_path：jmespath表达式，有关更多详细信息，请参考JMESPath教程<br>Expected_value：指定的期望值，变量或函数引用也可以在此处使用<br>消息（可选）：用于指示断言错误的原因</p>
<h4 id="RunTestCase（名称）"><a href="#RunTestCase（名称）" class="headerlink" title="RunTestCase（名称）"></a>RunTestCase（名称）</h4><p>RunTestCase 在一个步骤中用于引用另一个测试用例调用。<br>.name<br>RunTestCase 的参数用于指定测试步骤名称，该名称将显示在执行日志和测试报告中。<br>.with_variables<br>指定测试步骤变量。每个步骤的变量都是独立的，因此，如果要在多个步骤中共享变量，则应在配置变量中定义变量。此外，步骤变量将覆盖配置变量中具有相同名称的变量。<br>.call<br>指定引用的测试用例类。你在引用另一个测试用例的step中的参数时，需要先指定引用的测试用例类<br>.export<br>指定会话变量名称以从引用的测试用例中导出。导出的变量可以通过后续测试步骤step进行引用。导出的是step中的jmespath提取的变量，export之后，这个变量是全局变量，但是不能再confg中进行设置，因为测试类的引用是在step中进行的，而类的初始化是先初始化config，然后初始化teststeps，所以参数的传递在step之间</p>
<h3 id="env文件"><a href="#env文件" class="headerlink" title=".env文件"></a>.env文件</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、httprunner脚手架会默认创建创建.env文件，将需要设置为环境变量或全局变量的值，存储在env中</span><br><span class="line">2、使用$&#123;ENV(变量名)&#125;调用环境变量</span><br></pre></td></tr></table></figure>

<p>针对环境变量为列表信息的可以先设置为字符串，再进行字符串转列表操作</p>
<p>例如服务器连接（ip|port|user|pwd）：192.168.xxx.xxx|22|admin|admin</p>
<p>代码实现时，将字符串按“|”来进行切割，将结果保存在列表中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_file_to_service</span>(<span class="params">serviceInfo, local_path, remote_path</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param serviceInfo: 服务器信息格式：ip|port|user|pwd</span></span><br><span class="line"><span class="string">    :param local_path: 本地路径</span></span><br><span class="line"><span class="string">    :param remote_path: 远程路径</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    info = serviceInfo.split(<span class="string">&quot;|&quot;</span>)</span><br><span class="line">    t = paramiko.Transport(info[<span class="number">0</span>], int(info[<span class="number">1</span>]))</span><br><span class="line">    t.connect(username=info[<span class="number">2</span>], password=info[<span class="number">3</span>])</span><br><span class="line">    sftp = paramiko.SFTPClient.from_transport(t)</span><br><span class="line">    sftp.put(local_path, remote_path)  <span class="comment"># 上传文件到远程机</span></span><br><span class="line">    sftp.close()</span><br></pre></td></tr></table></figure>

<h3 id="debugtalk-py"><a href="#debugtalk-py" class="headerlink" title="debugtalk.py"></a>debugtalk.py</h3><p>debugtalk.py和pytest的conftest.py文件区别：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conftest.py文件中的定义对当前同级目录下及同级目录下的子目录下的脚本生效，而debugtalk.py按照脚手架的默认生成，只对同级目录testcases目录下的脚本生效，如果需要在testcase下面进行脚本的细分，创建新的模块目录，然后在里面添加测试脚本，是不生效的。</span><br></pre></td></tr></table></figure>

<p>debugtalk主要进行一些公共函数方法的编写例如常用的获取token、获取cookie，或者数据清理，环境初始化等操作，都可以放在debugtalk中。</p>
<p>将脚本中的方法引用到其他处，格式”${方法名}”，即能实现参数化</p>
<h3 id="setup和teardown及hook"><a href="#setup和teardown及hook" class="headerlink" title="setup和teardown及hook"></a>setup和teardown及hook</h3><p>httprunner的setup和teardown可以在yml或者json文件中定义(建议py文件中)</p>
<p>httprunner有两种setup和teardown的定义方式，一个是测试类级别，一个是测试步骤级别的定义。</p>
<h4 id="测试类级别的setup和teardown"><a href="#测试类级别的setup和teardown" class="headerlink" title="测试类级别的setup和teardown"></a>测试类级别的setup和teardown</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/user/bin/env python  </span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">self</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown</span>(<span class="params">self</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#结果为：</span></span><br><span class="line"><span class="comment">#Process finished with exit code 0  </span></span><br><span class="line"><span class="comment">#运行于测试用例之前  </span></span><br><span class="line"><span class="comment">#PASSED [100%]... </span></span><br><span class="line"><span class="comment">#运行于测试用例之后  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/user/bin/env python  </span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line">         </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#上面两种写法在unittest和pytest中是不一样的，setup_class是运行于测试类的前面，setup是运行与每个测试方法的前面，在httprunner貌似不区分这两个方法。</span></span><br></pre></td></tr></table></figure>

<h4 id="测试步骤前后的setup和teardown"><a href="#测试步骤前后的setup和teardown" class="headerlink" title="测试步骤前后的setup和teardown"></a>测试步骤前后的setup和teardown</h4><p>在debugtalk.py中写hook_up和hook_teardown</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_up</span>():</span>  </span><br><span class="line">    print(<span class="string">&quot;前置操作：setup!&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_down</span>(<span class="params">response=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;后置操作：teardown!&quot;</span>)  </span><br><span class="line">    <span class="keyword">if</span> response:  </span><br><span class="line">        print(response)  </span><br><span class="line">        response.status_code = <span class="number">300</span>  </span><br></pre></td></tr></table></figure>

<p>在demo_baidu_request_test.py中调用debugtalk的两个hook方法，使用setup_hook()和teardown_hook()来加载我们自定义的hook：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .setup_hook(<span class="string">&quot;$&#123;hook_up()&#125;&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .teardown_hook(<span class="string">&quot;$&#123;hook_down()&#125;&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#运行结果：</span></span><br><span class="line"><span class="comment">#Process finished with exit code 0  </span></span><br><span class="line"><span class="comment">#运行于测试用例之前  </span></span><br><span class="line"><span class="comment">#PASSED [100%]前置操作：setup!  </span></span><br><span class="line"><span class="comment">#后置操作：teardown!  </span></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="comment">#运行于测试用例之后  </span></span><br></pre></td></tr></table></figure>

<p>既然是hook方法，那么肯定是会集成一些内置的钩子，满足特殊的要求所使用的。<br>setup_hooks:在测试步骤前执行，先调用setup_hooks()内的函数。可以传入 $request 参数，可以对请求进行预处理或者修改，修改请求参数<br>teardown_hooks:在测试步骤执行后，先调用teardown()内的函数，可以传入$response参数，可以对返回值进行处理<br>先在debugtalk.py中定义两个方法，输出一下后面获取的request和response.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_up</span>(<span class="params">request=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;输出request:&#123;&#125;&quot;</span>.format(request))  </span><br><span class="line">    print(<span class="string">&quot;前置操作：setup!&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_down</span>(<span class="params">response=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;输出response:&#123;&#125;&quot;</span>.format(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;%s:%s&#x27;</span> % item <span class="keyword">for</span> item <span class="keyword">in</span> response.__dict__.items()])))  </span><br><span class="line">    print(<span class="string">&quot;后置操作：teardown!&quot;</span>)  </span><br></pre></td></tr></table></figure>

<p>在demo_baidu_request_test.py文件中调用这两个hook，然后传递参数$request和$response。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .setup_hook(<span class="string">&quot;$&#123;hook_up($request)&#125;&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .teardown_hook(<span class="string">&quot;$&#123;hook_down($response)&#125;&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#结果如下：</span></span><br><span class="line"><span class="comment">#Process finished with exit code 0  </span></span><br><span class="line"><span class="comment">#运行于测试用例之前  </span></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="comment">#前置操作：setup!  </span></span><br><span class="line"><span class="comment">#resp_obj:&lt;Response [200]&gt;  </span></span><br><span class="line"><span class="comment">#validation_results:&#123;&#125;  </span></span><br><span class="line"><span class="comment">#后置操作：teardown!  </span></span><br></pre></td></tr></table></figure>

<p>传入的是一个request和response对象，可以对传入的request和response对象进行操作,修改resquest和response传入和返回的值，完成复杂的业务要求。<br>改变一下debugtalk.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_up</span>(<span class="params">request=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;输出request:&#123;&#125;&quot;</span>.format(request))  </span><br><span class="line">    print(<span class="string">&quot;前置操作：setup!&quot;</span>)  </span><br><span class="line">    <span class="keyword">if</span> request:  </span><br><span class="line">        request[<span class="string">&quot;params&quot;</span>][<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;888888&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_down</span>(<span class="params">response=None</span>):</span>  </span><br><span class="line">    print(<span class="string">&quot;输出response:&#123;&#125;&quot;</span>.format(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;%s:%s&#x27;</span> % item <span class="keyword">for</span> item <span class="keyword">in</span> response.__dict__.items()])))  </span><br><span class="line">    print(<span class="string">&quot;后置操作：teardown!&quot;</span>)  </span><br><span class="line">    <span class="keyword">if</span> response:  </span><br><span class="line">        response.status_code = <span class="number">404</span>  </span><br></pre></td></tr></table></figure>

<p>修改了传入的setp的密码为“888888”，修改了step返回的状态码为404，看一下调用情况：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之前&quot;</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">teardown_class</span>(<span class="params">cls</span>):</span>  </span><br><span class="line">        print(<span class="string">&quot;运行于测试用例之后&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .variables(  </span><br><span class="line">            **&#123;  </span><br><span class="line">                <span class="string">&quot;username&quot;</span>: <span class="string">&quot;123456&quot;</span>  </span><br><span class="line">            &#125;  </span><br><span class="line">        )  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .setup_hook(<span class="string">&quot;$&#123;hook_up($request)&#125;&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .with_params(**&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$&#123;username&#125;&quot;</span>&#125;)  </span><br><span class="line">            .teardown_hook(<span class="string">&quot;$&#123;hook_down($response)&#125;&quot;</span>)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br><span class="line"><span class="comment">#执行结果：</span></span><br><span class="line"><span class="comment">#test_start </span></span><br><span class="line"><span class="comment">#运行于测试用例之前  </span></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="comment">#前置操作：setup!  </span></span><br><span class="line"><span class="comment">#输出response:resp_obj:&lt;Response [200]&gt;  </span></span><br><span class="line"><span class="comment">#validation_results:&#123;&#125;  </span></span><br><span class="line"><span class="comment">#后置操作：teardown  </span></span><br><span class="line"><span class="comment">#method   : GET  </span></span><br><span class="line"><span class="comment">#url      : https://www.baidu.com/?username=888888  </span></span><br><span class="line"><span class="comment">#httprunner.exceptions.ValidationFailure: assert status_code equal 200(int)  ==&gt; fail  </span></span><br><span class="line"><span class="comment">#check_item: status_code  </span></span><br><span class="line"><span class="comment">#check_value: 404(int)  </span></span><br><span class="line"><span class="comment">#assert_method: equal  </span></span><br><span class="line"><span class="comment">#expect_value: 200(int)  </span></span><br><span class="line"><span class="comment">#可以看到断言是失败的，设置的成功断言状态码是200，传入的request中的username开始是123456，截获请求参数后更改为了888888。在实际应用中，可以对于传入账号密码等进行加密，或者对于返回值的格式等进行解码操作</span></span><br></pre></td></tr></table></figure>

<h3 id="参数化数据驱动"><a href="#参数化数据驱动" class="headerlink" title="参数化数据驱动"></a>参数化数据驱动</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">支持三种入参，返回一个列表：</span><br><span class="line">1、列表：[&quot;iOS/10.1&quot;, &quot;iOS/10.2&quot;, &quot;iOS/10.3&quot;]</span><br><span class="line">2、Parameterize类的回调，例如csv：$&#123;parameterize(account.csv)&#125;</span><br><span class="line">3、debugtalk.py的回调，$&#123;gen_app_version()&#125;</span><br><span class="line">在使用参数化之前，首先要导入pytest包，和httprunner的Parameters这个类</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> Parameters  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(&quot;param&quot;, Parameters(  </span></span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: [<span class="number">111</span>, <span class="number">222</span>, <span class="number">333</span>]&#125;  </span><br><span class="line">    ))  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_start</span>(<span class="params">self, param</span>):</span>  </span><br><span class="line">        super().test_start(param)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .variables(  </span><br><span class="line">            **&#123;  </span><br><span class="line">                <span class="string">&quot;username&quot;</span>: <span class="string">&quot;$&#123;get_username()&#125;&quot;</span>  </span><br><span class="line">            &#125;  </span><br><span class="line">        )  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .with_params(**&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$username&quot;</span>&#125;)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br></pre></td></tr></table></figure>

<p>pytest.mark.parametrize()会先将param作为一个动态参数，传递给param，然后由httprunner在进行参数化，httprunner在pytest的parametrize上封装了一层，增加了csv及debugtalk.py参数化的支持。</p>
<h4 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> Parameters  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(&quot;param&quot;, Parameters(  </span></span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: [<span class="number">111</span>, <span class="number">222</span>, <span class="number">333</span>]&#125;  </span><br><span class="line">    ))  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_start</span>(<span class="params">self, param</span>):</span>  </span><br><span class="line">        super().test_start(param)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .variables(  </span><br><span class="line">            **&#123;  </span><br><span class="line">                <span class="string">&quot;username&quot;</span>: <span class="string">&quot;$&#123;get_username()&#125;&quot;</span>  </span><br><span class="line">            &#125;  </span><br><span class="line">        )  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .with_params(**&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$username&quot;</span>&#125;)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br></pre></td></tr></table></figure>

<h4 id="debugtalk-py的回调函数"><a href="#debugtalk-py的回调函数" class="headerlink" title="debugtalk.py的回调函数"></a>debugtalk.py的回调函数</h4><p>在debugtalk.py中定义一个函数，返回列表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_username</span>():</span>  </span><br><span class="line">    <span class="keyword">return</span> [  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;111111&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;222222&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;333333&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;444444&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;555555&quot;</span>&#125;,  </span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;666666&quot;</span>&#125;,  </span><br><span class="line">    ]  </span><br></pre></td></tr></table></figure>

<p>在xx_test.py文件调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> Parameters  </span><br><span class="line"><span class="keyword">from</span> httprunner <span class="keyword">import</span> HttpRunner, Config, Step, RunRequest, RunTestCase  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBaiduRequestTestCase</span>(<span class="params">HttpRunner</span>):</span>  </span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(&quot;param&quot;, Parameters(  </span></span><br><span class="line">        &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$&#123;get_username()&#125;&quot;</span>&#125;  </span><br><span class="line">    ))  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_start</span>(<span class="params">self, param</span>):</span>  </span><br><span class="line">        super().test_start(param)  </span><br><span class="line">  </span><br><span class="line">    config = (  </span><br><span class="line">        Config(<span class="string">&quot;get user list&quot;</span>)  </span><br><span class="line">        .base_url(<span class="string">&quot;https://www.baidu.com&quot;</span>)  </span><br><span class="line">        .verify(<span class="literal">False</span>)  </span><br><span class="line">    )  </span><br><span class="line">  </span><br><span class="line">    teststeps = [  </span><br><span class="line">        Step(  </span><br><span class="line">            RunRequest(<span class="string">&quot;get info&quot;</span>)  </span><br><span class="line">            .get(<span class="string">&quot;/&quot;</span>)  </span><br><span class="line">            .with_params(**&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;$username&quot;</span>&#125;)  </span><br><span class="line">            .validate()  </span><br><span class="line">            .assert_equal(<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>)  </span><br><span class="line">        )  </span><br><span class="line">    ]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    TestBaiduRequestTestCase().test_start()  </span><br></pre></td></tr></table></figure>

<h4 id="使用csv文件"><a href="#使用csv文件" class="headerlink" title="使用csv文件"></a>使用csv文件</h4><p>1.csv文件中的title要为变量名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name,pwd</span><br><span class="line">name1,123</span><br><span class="line">name2,123</span><br></pre></td></tr></table></figure>

<p>2.csv映射的时候，参数名要以“-”分割，name和pwd使用的-进行分割</p>
<p>3.csv的路径要使用相对路径，不支持绝对路径不支持\符号的路径</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(&quot;param&quot;, Parameters(  </span></span><br><span class="line">     &#123;<span class="string">&quot;name-pwd&quot;</span>: <span class="string">&quot;$&#123;parametrize(testdata/namepwd.csv)&#125;&quot;</span>&#125;  </span><br><span class="line"> )) </span><br></pre></td></tr></table></figure>

<h3 id="测试报告"><a href="#测试报告" class="headerlink" title="测试报告"></a>测试报告</h3><h4 id="pytest-html"><a href="#pytest-html" class="headerlink" title="pytest-html"></a>pytest-html</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest-html#安装pytest-html插件</span><br><span class="line">hrun testcasesPath --html=path/report.html</span><br></pre></td></tr></table></figure>

<h4 id="allure"><a href="#allure" class="headerlink" title="allure"></a>allure</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">生成测试结果</span></span><br><span class="line">hrun testcasePath --alluredir=resultPath#测试结果存放路径</span><br><span class="line"><span class="meta">#</span><span class="bash">第一种方式，会生成静态资源文件，通过静态资源index.html地址访问</span></span><br><span class="line">allure generate resultPath -o reportPath</span><br><span class="line"><span class="meta">#</span><span class="bash">第二种方式，不会生成静态资源文件，启动一个web服务，提供ip和port在线访问</span></span><br><span class="line">allure serve resultPath</span><br></pre></td></tr></table></figure>

<h3 id="调试、XML消息支持、XML格式断言"><a href="#调试、XML消息支持、XML格式断言" class="headerlink" title="调试、XML消息支持、XML格式断言"></a>调试、XML消息支持、XML格式断言</h3><h4 id="添加调试信息"><a href="#添加调试信息" class="headerlink" title="添加调试信息"></a>添加调试信息</h4><p>在调试代码时，引入loguru打印日志(httprunner源码中作者使用loguru.logger进行日志打印)</p>
<p>可在debugtalk.py中沿用此模块来进行日志打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from loguru import logger</span><br></pre></td></tr></table></figure>

<p>使用print未必会打印，但是使用logger.info会将信息打印到命令行中，格式为: logger.info()</p>
<h4 id="XML消息支持"><a href="#XML消息支持" class="headerlink" title="XML消息支持"></a>XML消息支持</h4><p>将报文内容写在文档中，用例中调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将报文内容保存在.xml文件中，使用get_file_std（）方法读取文件内容返回</span></span><br><span class="line">最后将变量m_encoder付给data关键字</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_file_std</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="comment"># 获取当前脚本所在文件夹路径</span></span><br><span class="line">    curPath = os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">    print(<span class="string">&#x27;curPath&#x27;</span>, curPath)</span><br><span class="line">    <span class="comment"># 获取文件路径</span></span><br><span class="line">    fileurl = os.path.join(curPath, <span class="string">&quot;messages/%s&quot;</span> % filename)</span><br><span class="line">    print(<span class="string">&#x27;fileurl&#x27;</span>, fileurl)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(fileurl, <span class="string">&quot;r+&quot;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br></pre></td></tr></table></figure>



<h4 id="xml报文断言实现"><a href="#xml报文断言实现" class="headerlink" title="xml报文断言实现"></a>xml报文断言实现</h4><h5 id="方案一：将xml报文内容作为整体进行断言操作"><a href="#方案一：将xml报文内容作为整体进行断言操作" class="headerlink" title="方案一：将xml报文内容作为整体进行断言操作"></a>方案一：将xml报文内容作为整体进行断言操作</h5><p>( 定义变量：xmlinfo <BatchNotifyRsp><ResultCode>0</ResultCode><ResultDec></ResultDec></BatchNotifyRsp>)</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">config:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;batch user order sync interface&quot;</span></span><br><span class="line">    <span class="attr">base_url:</span> <span class="string">$&#123;ENV(49_HOST)&#125;</span></span><br><span class="line">    <span class="attr">verify:</span> <span class="literal">False</span></span><br><span class="line">    <span class="attr">variables:</span></span><br><span class="line">        <span class="attr">localpath:</span> <span class="string">&quot;D:\\work\\wy_only\\CtIntfDemo\\data\\update.txt&quot;</span></span><br><span class="line">        <span class="attr">remotepath:</span> <span class="string">&quot;/iot/Filesync/User_20201027150556_7169060048412345.txt&quot;</span></span><br><span class="line">        <span class="attr">49serv:</span> <span class="string">$&#123;ENV(49_SERV)&#125;</span></span><br><span class="line">        <span class="attr">oracle1:</span> <span class="string">$&#123;ENV(oracle11)&#125;</span></span><br><span class="line">        <span class="attr">xmlinfo:</span> <span class="string">&#x27;&lt;BatchNotifyRsp&gt;&lt;ResultCode&gt;0&lt;/ResultCode&gt;&lt;ResultDec&gt;&lt;/ResultDec&gt;&lt;/BatchNotifyRsp&gt;&#x27;</span></span><br><span class="line"><span class="number">12345678910</span></span><br></pre></td></tr></table></figure>

<p>断言：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attr">variables:</span></span><br><span class="line">        <span class="attr">file_path:</span> <span class="string">&quot;data\\batchOrderSync.xml&quot;</span></span><br><span class="line">        <span class="attr">m_encoder:</span> <span class="string">$&#123;get_file_std($file_path)&#125;</span></span><br><span class="line">        <span class="attr">retbody:</span> <span class="string">$&#123;str_bytes($xmlinfo)&#125;</span> <span class="comment"># 将str格式转化为bytes格式</span></span><br><span class="line">    <span class="attr">request:</span></span><br><span class="line">        <span class="attr">method:</span> <span class="string">POST</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">/Sync/BatchOperatorNotify/User</span></span><br><span class="line">        <span class="attr">headers:</span></span><br><span class="line">            <span class="attr">Content-Type:</span> <span class="string">application/xml</span></span><br><span class="line">        <span class="attr">data:</span> <span class="string">$m_encoder</span></span><br><span class="line">    <span class="attr">validate:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]</span><br><span class="line">        <span class="comment"># - eq: [body.BatchNotifyRsp.ResultCode, &quot;0&quot;]</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">body</span>, <span class="string">$retbody</span>]   <span class="comment">#直接断言返回xml整体</span></span><br><span class="line"><span class="number">1234567891011121314</span></span><br></pre></td></tr></table></figure>

<p>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_bytes</span>(<span class="params">str</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param str:字符串</span></span><br><span class="line"><span class="string">    :return:bytes类型</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bytes(str, encoding=<span class="string">&quot;utf8&quot;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="方案二：将xml报文内容转为json格式，再将返回结果赋值为转化后的json，最后进行json格式断言。"><a href="#方案二：将xml报文内容转为json格式，再将返回结果赋值为转化后的json，最后进行json格式断言。" class="headerlink" title="方案二：将xml报文内容转为json格式，再将返回结果赋值为转化后的json，最后进行json格式断言。"></a>方案二：将xml报文内容转为json格式，再将返回结果赋值为转化后的json，最后进行json格式断言。</h5><p>teardown_hooks机制，会在断言之前执行</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">teardown_hooks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$&#123;teardown_hook_xml_json($response)&#125;</span></span><br></pre></td></tr></table></figure>

<p>断言：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">validate:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">&quot;status_code&quot;</span>, <span class="number">200</span>]</span><br><span class="line">    <span class="bullet">-</span> <span class="attr">eq:</span> [<span class="string">body.BatchNotifyRsp.ResultCode</span>, <span class="string">&quot;0&quot;</span>]</span><br><span class="line">    <span class="comment">#- eq: [body, $retbody]   #直接断言返回xml整体</span></span><br></pre></td></tr></table></figure>

<p>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xml_to_json</span>(<span class="params">xml_str</span>):</span></span><br><span class="line">    <span class="comment"># parse是的xml解析器</span></span><br><span class="line">    xml_parse = xmltodict.parse(xml_str)</span><br><span class="line">    <span class="comment"># json库dumps()是将dict转化成json格式,loads()是将json转化成dict格式。</span></span><br><span class="line">    <span class="comment"># dumps()方法的ident=1,格式化json</span></span><br><span class="line">    json_str = json.dumps(xml_parse, indent=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> json_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">teardown_hook_xml_json</span>(<span class="params">response</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将xml报文内容转化为json格式内容,并将返回内容替换成json格式</span></span><br><span class="line"><span class="string">    :param response: 返回报文对象</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    jsoninfo = xml_to_json(response.body)</span><br><span class="line">    response.body = json.loads(jsoninfo)</span><br></pre></td></tr></table></figure>

<h3 id="questions"><a href="#questions" class="headerlink" title="questions"></a>questions</h3><p>1.查看log时，或者报错信息是中文时，显示unicode编码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可以在httprunner/client.py 文件中添加 ensure_ascii=False修改以下代码如下：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_print</span>(<span class="params">req_or_resp, r_type</span>):</span></span><br><span class="line">msg = <span class="string">f&quot;\n================== <span class="subst">&#123;r_type&#125;</span> details ==================\n&quot;</span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> req_or_resp.dict().items():</span><br><span class="line"><span class="keyword">if</span> isinstance(value, dict):</span><br><span class="line">value = json.dumps(value, indent=<span class="number">4</span>, ensure_ascii=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>2.cookies管理</p>
<p>httprunner继承requests,可自动管理</p>
<p>403 Forbidden,一般是网站处于安全考虑，缺少cookies导致(有些接口需要用到cookies，cookie没关联起来)</p>
<p>隐藏参数csrfmiddlewaretoken</p>
<p>csrfmiddlewaretoken参数是html页面上的隐藏参数,是为了防止跨域伪造请求。每次刷新页面都会自动变，需要先把此参数提取出来，动态关联到请求参数的body里面</p>
</div></div><a class="button-hover more" href="/bq/f4f84727.html#more">阅读全文</a></div><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/ea66df61.html">docker使用</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-06-03</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E5%B7%A5%E5%85%B7/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/docker/">docker</a></div></div><div class="post-content"><div class="main-content content"><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.停止所有的container，这样才能够删除其中的images：</span></span><br><span class="line">docker stop $(docker ps -a -q)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果想要删除所有container：</span></span><br><span class="line">docker rm $(docker ps -a -q)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.查看当前有些什么images</span></span><br><span class="line">docker images</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.删除images，通过image的id来指定删除谁</span></span><br><span class="line">docker rmi &lt;image id&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 想要删除untagged images，也就是那些id为&lt;None&gt;的image的话可以用</span></span><br><span class="line">docker rmi $(docker images | grep &quot;^&lt;none&gt;&quot; | awk &quot;&#123;print $3&#125;&quot;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除全部image</span></span><br><span class="line">docker rmi $(docker images -q)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出容器</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.退出并停止容器：（而后执行docker ps不能看到该容器）</span></span><br><span class="line">Ctrl+D</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.退出但不停止容器：而后执行docker ps能看到该容器）<span class="string">&quot;</span></span></span><br><span class="line">Ctrl+P+Q</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器(只能进入已经启动了的容器,若容器已经停止,则先执行docker start &lt;容器名称或ID&gt; 来启动容器)</span></span><br><span class="line">docker attach &lt;容器名称或ID&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动/停止容器</span></span><br><span class="line">docker start/stop &lt;容器名称或ID&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看镜像</span></span><br><span class="line">docker images </span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交镜像,(docker commit &lt;容器名称或id&gt; &lt;自定镜像名称&gt;:&lt;自定版本号TAG&gt; )</span></span><br><span class="line">docker commit 2736  myproject:1.0.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看镜像的修改历史</span></span><br><span class="line">docker history 镜像ID</span><br><span class="line"><span class="meta">#</span><span class="bash"> 连接到容器上运行bash</span></span><br><span class="line">docker exec -ti CONTAINER /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除镜像</span></span><br><span class="line">docker rmi IMAGE ID</span><br><span class="line">docker rmi REPOSITORY+TAG</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看版本</span></span><br><span class="line">docker  version </span><br><span class="line"><span class="meta">#</span><span class="bash"> 搜索可用docker镜像</span></span><br><span class="line">docker  search centos</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载镜像</span></span><br><span class="line">docker  pull  centos </span><br><span class="line"><span class="meta">#</span><span class="bash"> docker导入本地镜像</span></span><br><span class="line">cat  centos.tar | docker import  -  centos6  </span><br><span class="line"><span class="meta">#</span><span class="bash"> docker导出镜像</span></span><br><span class="line">docker  export  id  &gt; cenos6.tar  </span><br><span class="line"><span class="meta">#</span><span class="bash"> 在docker容器中运行hello world!</span></span><br><span class="line">docker run centos echo &quot;hello word&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器中安装ntpdate的程序</span></span><br><span class="line">docker run centos yum install ntpdate</span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭容器</span></span><br><span class="line">docker stop id </span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动某个容器</span></span><br><span class="line">docker start id </span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除容器</span></span><br><span class="line">docker rm id </span><br><span class="line"><span class="meta">#</span><span class="bash">容器主机间文件复制</span></span><br><span class="line"><span class="meta">#</span><span class="bash">从主机复制到容器</span></span><br><span class="line">sudo docker cp host_path containerID:container_path</span><br><span class="line"><span class="meta">#</span><span class="bash">从容器复制到主机</span></span><br><span class="line">sudo docker cp containerID:container_path host_path</span><br></pre></td></tr></table></figure>

<h3 id="启动，端口映射及目录挂载"><a href="#启动，端口映射及目录挂载" class="headerlink" title="启动，端口映射及目录挂载"></a>启动，端口映射及目录挂载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从镜像启动容器</span></span><br><span class="line">docker run -d -p 9090:8080 --name testproject myproject:1.0.0 /root/run.sh</span><br><span class="line">-d：</span><br><span class="line"><span class="meta">#</span><span class="bash"> 表示以“守护模式”执行/root/run.sh脚本，此时 Tomcat 控制台不会出现在输出终端上。此时需要查看日志使用命令:docker logs &lt;容器名称或ID&gt;</span></span><br><span class="line">-p：</span><br><span class="line"><span class="meta">#</span><span class="bash"> 表示宿主机与容器的端口映射，此时将容器内部的 8080 端口映射为宿主机的 9090 端口，这样就向外界暴露了 9090 端口，可通过 Docker 网桥来访问容器内部的 8080 端口了。  </span></span><br><span class="line">--name：</span><br><span class="line"><span class="meta">#</span><span class="bash"> 表示容器名称，用一个有意义的名称命名即可<span class="string">&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 把所需要的环境（如jdk，tomcat等）拉取到docker容器中 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方法一：启动一个容器，同时指定将宿主机中的某个文件夹挂载到docker容器中,-v参数中，冒号<span class="string">&quot;:&quot;</span>前面的目录是宿主机目录，后面的目录是容器内目录 </span></span><br><span class="line">docker run -i -t -v /myjava/:/mnt/software/ ubuntu /bin/bash</span><br><span class="line">-i:</span><br><span class="line"><span class="meta">#</span><span class="bash"> 以交互模式运行容器，通常与 -t 同时使用；</span></span><br><span class="line">-t:</span><br><span class="line"><span class="meta">#</span><span class="bash"> 为容器重新分配一个伪输入终端，通常与 -i 同时使用(容器启动后会进入其命令行)；</span></span><br><span class="line">-v: </span><br><span class="line"><span class="meta">#</span><span class="bash">指定宿主机的哪个目录挂载到容器中，格式：-v &lt;宿主机目录&gt;:&lt;容器目录&gt; </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方法二：使用docker cp 命令拷贝文件，（docker cp &lt;宿主机目录或文件&gt; &lt;容器名称或id&gt;:&lt;容器目录&gt;）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 若已经在容器里面，则先退出容器，退出容器后执行命令： </span></span><br><span class="line">docker cp myjava/ 190d:mnt/software/ </span><br></pre></td></tr></table></figure>

<h3 id="便捷搭建服务搭建"><a href="#便捷搭建服务搭建" class="headerlink" title="便捷搭建服务搭建"></a>便捷搭建服务搭建</h3><h4 id="jernkins"><a href="#jernkins" class="headerlink" title="jernkins"></a>jernkins</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name jenkins -p 8080:8080 -p 50000:50000 -v ~/docker/jenkins:/var/jenkins_home jenkins/jenkins</span><br><span class="line">chown -R 1000:1000 ~/docker/jenkins</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">更换插件源地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash">进入jenkins的工作目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash">hudson.model.UpdateCenter.xml  </span></span><br><span class="line"><span class="meta">#</span><span class="bash">http://updates.jenkins-io/update-center.json</span></span><br><span class="line"><span class="meta">#</span><span class="bash">改成</span></span><br><span class="line"><span class="meta">#</span><span class="bash">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 发现http://updates.jenkins-io/update-center.json https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json 内容一样,需修改json文件里的实际地址</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">进入Jenkins工作目录：</span></span><br><span class="line">cd /var/lib/jenkins/updates/</span><br><span class="line"><span class="meta">#</span><span class="bash">使用sed命令修改default.json文件：</span></span><br><span class="line">sed -i &#x27;s#https://updates.jenkins.io/download#https://mirrors.tuna.tsinghua.edu.cn/jenkins#g&#x27; default.json &amp;&amp; sed -i &#x27;s#http://www.google.com#https://www.baidu.com#g&#x27; default.json</span><br></pre></td></tr></table></figure>

<h5 id="jenkins节点失联"><a href="#jenkins节点失联" class="headerlink" title="jenkins节点失联"></a>jenkins节点失联</h5><p>如果您不想重新启动，则只需在从站上终止这些进程,然后再次启动从属代理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ps -ef |grep java</span></span><br><span class="line">1006 11948 11930 0 Jul17？00:00:00 bash -c cd“/ mnt / jenkins”&amp;&amp; java -jar slave.jar</span><br><span class="line">1006 11949 11948 0 Jul17？00:02:55 java -jar slave.jar</span><br></pre></td></tr></table></figure>

<h5 id="Timestamper"><a href="#Timestamper" class="headerlink" title="Timestamper"></a>Timestamper</h5><p>job配置，构建环境中勾选：Add timestamps to the Console Output。执行时控制台输出就会在每一行显示时间</p>
<p>对于脚本化管道，只需将您的脚本包装在<code>timestamps &#123; &#125;</code> Eg中即可。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">timestamps &#123;</span><br><span class="line">  <span class="comment">// do your job</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>向声明管道添加选项</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  options &#123; timestamps () &#125;</span><br><span class="line">  <span class="comment">// stages and rest of pipeline.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>全局配置：在Jenkins配置的“时间戳”部分中选中“为所有管道版本启用”</p>
<h5 id="QQ-amp-微信通知"><a href="#QQ-amp-微信通知" class="headerlink" title="QQ&amp;微信通知"></a>QQ&amp;微信通知</h5><p><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4320414/blog/3930777">https://my.oschina.net/u/4320414/blog/3930777</a></p>
<h5 id="钉钉通知"><a href="#钉钉通知" class="headerlink" title="钉钉通知"></a>钉钉通知</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/liujingqiu/article/details/87977396">https://blog.csdn.net/liujingqiu/article/details/87977396</a></p>
<p>重置Jenkins的build序号</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 系统管理-&gt;脚本命令行</span><br><span class="line">item = Jenkins.instance.getItemByFullName(<span class="string">&quot;your-job-name-here&quot;</span>)</span><br><span class="line"><span class="comment">//THIS WILL REMOVE ALL BUILD HISTORY</span></span><br><span class="line">item.builds.each() &#123; build -&gt;</span><br><span class="line">  build.delete()</span><br><span class="line">&#125;</span><br><span class="line">item.updateNextBuildNumber(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h4 id="sonar"><a href="#sonar" class="headerlink" title="sonar"></a>sonar</h4><h5 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker pull postgres</span><br><span class="line">docker pull sonarqube</span><br><span class="line">docker run -p 5432:5432 --name db -e POSTGRES_USER=sonar -e POSTGRES_PASSWORD=sonar -d postgres</span><br><span class="line">docker run --name sq -e SONARQUBE_JDBC_URL=jdbc:postgresql://172.31.19.221:5432/sonar -e SONARQUBE_JDBC_USERNAME=sonar -e SONARQUBE_JDBC_PASSWORD=sonar -p 9000:9000 -d sonarqube</span><br><span class="line"><span class="meta">#</span><span class="bash">加插件:https://github.com/rhinoceros/sonar-p3c-pmd/releases/tag/pmd-3.2.0-beta-with-p3c1.3.6-pmd6.10.0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">https://gitee.com/chenlingtao/sonar-pmd.git</span></span><br><span class="line">docker stop d0c95e1e9270</span><br><span class="line">docker cp /home/docker/sonarqube/extensions/plugins/sonar-pmd-plugin-3.2.0-SNAPSHOT.jar</span><br><span class="line">d0c95e1e9270:/opt/sonarqube/extensions/plugins</span><br><span class="line">docker start d0c95e1e9270</span><br><span class="line"><span class="meta">#</span><span class="bash">宿主机目录挂载,方便加插件</span></span><br><span class="line">docker run -v /home/bq/docker/sonarqube/extensions/plugins:/opt/sonarqube/extensions/plugins --name sq --link db -e SONARQUBE_JDBC_URL=jdbc:postgresql://db:5432/sonar -e SONARQUBE_JDBC_USERNAME=sonar -e SONARQUBE_JDBC_PASSWORD=sonar -p 9000:9000 -d sonarqube</span><br><span class="line">docker run -v ~/docker/sonarqube/extensions/plugins:/opt/sonarqube/extensions/plugins --name sq -e SONARQUBE_JDBC_URL=jdbc:postgresql://172.17.225.160:5432/sonar -e SONARQUBE_JDBC_USERNAME=sonar -e SONARQUBE_JDBC_PASSWORD=sonar -p 9000:9000 -d sonarqube </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">内存要够,不够es抛137;sudo sysctl -w vm.max_map_count=524288 太小es抛78</span></span><br></pre></td></tr></table></figure>

<h5 id="扫描"><a href="#扫描" class="headerlink" title="扫描"></a>扫描</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sonar-scanner.bat -D&quot;sonar.projectKey=homepage&quot; -D&quot;sonar.sources=./src&quot; -D&quot;sonar.java.binaries=./out&quot; -D&quot;sonar.host.url=http://ec2-<span class="number">52</span>-<span class="number">221</span>-<span class="number">237</span>-<span class="number">133</span>.ap-southeast-<span class="number">1</span>.compute.amazonaws.com:<span class="number">9000</span>&quot; -D&quot;sonar.login=<span class="number">31</span>d831eb5f55827eb84201821a921ed3131ae455&quot;</span><br></pre></td></tr></table></figure>

<h4 id="禅道"><a href="#禅道" class="headerlink" title="禅道"></a>禅道</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建docker网络驱动</span></span><br><span class="line"><span class="meta">#</span><span class="bash">sudo docker network create --subnet=[ip范围] [网络驱动名]</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ip范围：例如172.172.172.0/24的意思ip可以指定范围为172.172.172.1到172.172.172.254；网络驱动名：创建的网络驱动名，可随意指定；</span></span><br><span class="line">docker network create --subnet=172.172.172.0/24 zentaonet</span><br><span class="line"><span class="meta">#</span><span class="bash">启动</span></span><br><span class="line">docker run --name zentao -p 8090:80 --network=zentaonet --ip 172.172.172.172 --mac-address 02:42:ac:11:00:00 -v ~/docker/zentao/zentaopms:/www/zentaopms -v ~/docker/zentao/mysqldata:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d easysoft/zentao:latest</span><br></pre></td></tr></table></figure>

</div></div><a class="button-hover more" href="/bq/ea66df61.html#more">阅读全文</a></div><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/a4dd3dba.html">influxdb&amp;Grafana搭建可视化监控平台</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-06-03</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E9%80%9A%E7%94%A8/">通用</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E9%80%9A%E7%94%A8/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/">服务搭建</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/influxdb/">influxdb</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Grafana/">Grafana</a></div></div><div class="post-content"><div class="main-content content"><h3 id="influxdb部署"><a href="#influxdb部署" class="headerlink" title="influxdb部署"></a>influxdb部署</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">拉取influxdb镜像</span></span><br><span class="line">docker pull influxdb:1.8.1</span><br><span class="line"><span class="meta">#</span><span class="bash">启动influxdb</span></span><br><span class="line">docker run -d -p 8086:8086 --name influxdb influxdb:1.8.1</span><br><span class="line"><span class="meta">#</span><span class="bash">进入容器</span></span><br><span class="line">docker exec -it influxdb bash</span><br><span class="line"><span class="meta">#</span><span class="bash">查看相关工具</span></span><br><span class="line">cd /usr/bin </span><br><span class="line">find | grep influx  </span><br><span class="line">./influx</span><br><span class="line">./influx_inspect</span><br><span class="line">./influx_stress</span><br><span class="line">./influx_tsm</span><br><span class="line">./influxd</span><br><span class="line"><span class="meta">#</span><span class="bash">查看Influxdb版本</span></span><br><span class="line">./influx -version</span><br><span class="line"><span class="meta">#</span><span class="bash">查看数据库</span></span><br><span class="line"><span class="meta">/usr/bin#</span><span class="bash"> ./influx</span></span><br><span class="line">Connected to http://localhost:8086 version 1.6.1</span><br><span class="line">InfluxDB shell version: 1.6.1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show databases</span></span><br><span class="line">name: databases</span><br><span class="line">name</span><br><span class="line">----</span><br><span class="line">_internal</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">exit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">创建数据库</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> create database testdb</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show databases</span></span><br><span class="line">name: databases</span><br><span class="line">name</span><br><span class="line">----</span><br><span class="line">_internal</span><br><span class="line">testdb</span><br><span class="line"><span class="meta">#</span><span class="bash">删除数据库</span></span><br><span class="line">drop database [db_name]</span><br><span class="line"><span class="meta">#</span><span class="bash">使用数据库</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use testdb</span></span><br><span class="line">Using database testdb</span><br></pre></td></tr></table></figure>

<h3 id="grafana部署"><a href="#grafana部署" class="headerlink" title="grafana部署"></a>grafana部署</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">拉取grafana镜像</span></span><br><span class="line">docker pull grafana/grafana:7.1.5</span><br><span class="line"><span class="meta">#</span><span class="bash">启动grafana</span></span><br><span class="line">docker run -d -p 3000:3000 --name grafana grafana/grafana:7.1.5</span><br><span class="line">（用户名密码默认为：admin）</span><br></pre></td></tr></table></figure>

<h3 id="ifluxdb的数据上传"><a href="#ifluxdb的数据上传" class="headerlink" title="ifluxdb的数据上传"></a>ifluxdb的数据上传</h3><p><a target="_blank" rel="noopener" href="https://docs.influxdata.com/influxdb/v1.7/tools/shell/#import-data-from-a-file-with-import">https://docs.influxdata.com/influxdb/v1.7/tools/shell/#import-data-from-a-file-with-import</a></p>
<p>将单个点写入mydb数据库。数据包括测量值cpu_load_short，具有标签值server01和us-west的标签键host和region，具有字段值0.64的字段键值以及时间戳1434055562000000000</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -XPOST &#x27;http://localhost:8086/write?db=mydb&#x27; --data-binary &#x27;cpu_load_short,host=server01,region=us-west value=0.64 1434055562000000000&#x27;</span><br></pre></td></tr></table></figure></div></div><a class="button-hover more" href="/bq/a4dd3dba.html#more">阅读全文</a></div><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/5a092796.html">Battery Historian--Android耗电分析</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-04-11</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/">Test</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Test/%E4%B8%93%E9%A1%B9%E6%B5%8B%E8%AF%95/">专项测试</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/%E4%B8%93%E9%A1%B9%E6%B5%8B%E8%AF%95/">专项测试</a></div></div><div class="post-content"><div class="main-content content"><h3 id="Battery-Historian服务部署"><a href="#Battery-Historian服务部署" class="headerlink" title="Battery Historian服务部署"></a>Battery Historian服务部署</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker search battery  </span><br><span class="line">docker run --name=battery -d -p 9999:9999 bhaavan/battery-historian</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如有代理</span></span><br><span class="line">docker run -p port_number：9999 gcr.io/android-battery-historian/stable:3.0 --port 9999</span><br></pre></td></tr></table></figure>

<p>浏览器打开：<a target="_blank" rel="noopener" href="http://host:9999/">http://host:9999/</a></p>
<p>耗电统计是系统组件，伴随系统运行的整个过程，也就是说系统运行他就一直在统计。这个统计是基于软件层面实现的，不同的硬件模块配置了不同的<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://androidxref.com/8.0.0_r4/xref/frameworks/base/core/res/res/xml/power_profile.xml">参数</a>，然后使用算法进行估算，power_profile文件的参数值OEM厂商必须测量并提供前实际值，所以不同的厂商是不一样的。另外获取统计报告的时候需要将统计重置，并断开usb连接（连接时充电影响统计有效性）</p>
<h3 id="设备耗电报告获取分析"><a href="#设备耗电报告获取分析" class="headerlink" title="设备耗电报告获取分析"></a>设备耗电报告获取分析</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 默认情况下，统计信息是在运行基础上维护的，Android也不记录特定于应用程序的用户空间wakelock转换的时间戳。如果您希望Historian在时间线上显示关于每个单独唤醒锁的详细信息，则应在开始实验之前使用以下命令启用完整唤醒锁报告（启用完全唤醒锁定报告，电池历史记录将在几个小时内溢出。使用此选项进行短时间测试（3-4小时））</span></span><br><span class="line">adb shell dumpsys batterystats --enable full-wake-history</span><br><span class="line"><span class="meta">#</span><span class="bash"> 采集报告前将battery统计状态重置，重置命令结束后断开usb，操作app进行相应活动，测试结束后用获取报告命令导出统计文件包</span></span><br><span class="line">adb shell dumpsys batterystats --reset</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安卓7.0及以上</span></span><br><span class="line">adb bugreport &gt; bugreport.zip</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安卓6.0及以下</span></span><br><span class="line">adb bugreport &gt; bugreport.txt</span><br></pre></td></tr></table></figure>

<p>报告上传上述服务，可查看分析结果</p>
</div></div><a class="button-hover more" href="/bq/5a092796.html#more">阅读全文</a></div><div class="recent-post-item"><i class="article-top"></i><a class="post-title" href="/bq/725be948.html">Yapi</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2021-06-03</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E9%80%9A%E7%94%A8/">通用</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/%E9%80%9A%E7%94%A8/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/">服务搭建</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Yapi/">Yapi</a></div></div><div class="post-content"><div class="main-content content"><h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><p>源码地址:<a target="_blank" rel="noopener" href="https://github.com/YMFE/yapi">https://github.com/YMFE/yapi</a></p>
<p>使用:<a target="_blank" rel="noopener" href="https://www.freesion.com/article/7738391556/">https://www.freesion.com/article/7738391556/</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">使用 Docker 构建 Yapi</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1、启动 MongoDB</span></span><br><span class="line">docker run -d --name mongo-yapi mongo</span><br><span class="line"><span class="meta">#</span><span class="bash">2、获取 Yapi 镜像，版本信息可在 阿里云镜像仓库 查看</span></span><br><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/anoy/yapi</span><br><span class="line"><span class="meta">#</span><span class="bash">3、初始化 Yapi 数据库索引及管理员账号</span></span><br><span class="line">docker run -it --rm \</span><br><span class="line">  --link mongo-yapi:mongo \</span><br><span class="line">  --entrypoint npm \</span><br><span class="line">  --workdir /api/vendors \</span><br><span class="line">  registry.cn-hangzhou.aliyuncs.com/anoy/yapi \</span><br><span class="line">  run install-server</span><br><span class="line"><span class="meta">#</span><span class="bash">自定义配置文件挂载到目录 /api/config.json</span></span><br><span class="line"><span class="meta">#</span><span class="bash">官方自定义配置文件 https://github.com/YMFE/yapi/blob/master/config_example.json</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4、启动 Yapi 服务</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name yapi \</span><br><span class="line">  --link mongo-yapi:mongo \</span><br><span class="line">  --workdir /api/vendors \</span><br><span class="line">  -p 8880:3000 \</span><br><span class="line">  registry.cn-hangzhou.aliyuncs.com/anoy/yapi \</span><br><span class="line">  server/app.js </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">访问 http://localhost:8880 登录账号 admin@admin.com，密码 ymfe.org</span></span><br><span class="line"><span class="meta">#</span><span class="bash">关闭 Yapi</span></span><br><span class="line">docker stop yapi</span><br><span class="line"><span class="meta">#</span><span class="bash">启动 Yapi</span></span><br><span class="line">docker start yapi</span><br><span class="line"><span class="meta">#</span><span class="bash">升级 Yapi</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1、停止并删除旧版容器</span></span><br><span class="line">docker rm -f yapi</span><br><span class="line"><span class="meta">#</span><span class="bash">2、获取最新镜像</span></span><br><span class="line">docker pull registry.cn-hangzhou.aliyuncs.com/anoy/yapi</span><br><span class="line"><span class="meta">#</span><span class="bash">3、启动新容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name yapi \</span><br><span class="line">  --link mongo-yapi:mongo \</span><br><span class="line">  --workdir /api/vendors \</span><br><span class="line">  -p 8880:3000 \</span><br><span class="line">  registry.cn-hangzhou.aliyuncs.com/anoy/yapi \</span><br><span class="line">  server/app.js  </span><br><span class="line"><span class="meta">#</span><span class="bash">手动构建 yapi 镜像</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1、下载 YAPI 到本地</span></span><br><span class="line">wget -o yapi.tar.gz https://github.com/YMFE/yapi/archive/v1.8.0.tar.gz</span><br><span class="line">下载地址：https://github.com/YMFE/yapi/releases</span><br><span class="line"><span class="meta">#</span><span class="bash">2、编辑 Dockerfile</span></span><br><span class="line">FROM node:12-alpine as builder</span><br><span class="line">RUN apk add --no-cache git python make openssl tar gcc</span><br><span class="line">COPY yapi.tar.gz /home</span><br><span class="line">RUN cd /home &amp;&amp; tar zxvf yapi.tar.gz &amp;&amp; mkdir /api &amp;&amp; mv /home/yapi-1.8.0 /api/vendors</span><br><span class="line">RUN cd /api/vendors &amp;&amp; \</span><br><span class="line">    npm install --production --registry https://registry.npm.taobao.org</span><br><span class="line">FROM node:12-alpine</span><br><span class="line">MAINTAINER 545544032@qq.com</span><br><span class="line">ENV TZ=&quot;Asia/Shanghai&quot; HOME=&quot;/&quot;</span><br><span class="line">WORKDIR $&#123;HOME&#125;</span><br><span class="line">COPY --from=builder /api/vendors /api/vendors</span><br><span class="line">COPY config.json /api/</span><br><span class="line">EXPOSE 3000</span><br><span class="line">ENTRYPOINT [&quot;node&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash">3、构建镜像</span></span><br><span class="line">docker build -t yapi .</span><br></pre></td></tr></table></figure>

<h3 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h3><p>yapi的数据库是MongoDB，所以yapi的数据备份和恢复实际上就是MongoDB的数据备份与恢复，使用复制数据库文件夹，然后进行覆盖，是不可以将数据成功迁移的！<br>MongoDB的数据恢复一般是覆盖原有数据，如果想保留原有的数据，可以写脚本，以插入的形式添加。但若新数据与原有数据有重复，会添加错误，只能编写脚本判断</p>
<h4 id="在yapi页面进行数据导出及导入"><a href="#在yapi页面进行数据导出及导入" class="headerlink" title="在yapi页面进行数据导出及导入"></a>在yapi页面进行数据导出及导入</h4><h4 id="数据库数据迁移"><a href="#数据库数据迁移" class="headerlink" title="数据库数据迁移"></a>数据库数据迁移</h4><p>这里主要使用两个命令：mongodump、mongorestore</p>
<h5 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出"></a>数据导出</h5><ul>
<li>-h：<br> MongDB所在服务器地址，例如：127.0.0.1，当然也可以指定端口号：127.0.0.1:27017</li>
<li>-d：<br> 需要备份的数据库实例，例如：yapi</li>
<li>-o：<br> 备份的数据存放位置，例如：/home/apps，当然该目录需要提前建立，在备份完成后，系统自动在dump目录下建立一个yapi目录，这个目录里面存放该数据库实例的备份数据。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mongo </span></span><br><span class="line"><span class="comment"># show dbs</span></span><br><span class="line"><span class="built_in">local</span> 0.000GB </span><br><span class="line">yapi 0.010GB</span><br><span class="line"><span class="comment"># exit </span></span><br><span class="line">导出： </span><br><span class="line"><span class="comment"># mongodump -h dbhost -d dbname -o dbdirectory 用法</span></span><br><span class="line"><span class="comment"># mongodump -d yapi -o /home/apps/</span></span><br><span class="line"><span class="comment"># 如果yapi搭建在容器内，希望在宿主机上执行该命令，则可以调整成：</span></span><br><span class="line"><span class="comment"># docker exec $容器名 mongodump -d yapi -o /my-yapi/</span></span><br></pre></td></tr></table></figure>

<h5 id="数据导入"><a href="#数据导入" class="headerlink" title="数据导入"></a>数据导入</h5><ul>
<li>–h：<br> MongoDB所在服务器地址，默认为： localhost:27017</li>
<li>-d ：<br> 需要恢复的数据库实例，例如：yapi，当然这个名称也可以和备份时候的不一样，比如test</li>
<li>–drop：<br> 恢复的时候，先删除当前数据，然后恢复备份的数据。就是说，恢复后，备份后添加修改的数据都会被删除，慎用哦！</li>
<li>backupdirectory：<br> mongorestore 最后的一个参数，设置备份数据所在位置，例如：/home/apps/yapi。</li>
<li>–dir：<br> 指定备份的目录</li>
</ul>
<p>如果在其他主机部署了一个新的yapi，那么最好先把现有的记录删除。最好备份恢复时让mongodb以及yapi版本保持一致，不然容易出错。同时最好加上–drop选项，保证恢复的完整性。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mongorestore -h dbhost -d dbname --dir backupdirectory</span><br><span class="line">mongorestore -d yapi --drop --dir /home/apps/yapi</span><br><span class="line"><span class="comment"># docker</span></span><br><span class="line">docker cp /home/jenkins/yapi 3b16a957f479:/home/apps</span><br><span class="line">docker <span class="built_in">exec</span> 3b16a957f479  mongorestore -d yapi --drop --dir /home/apps/yapi</span><br></pre></td></tr></table></figure>

<h3 id="项目合并统一文档"><a href="#项目合并统一文档" class="headerlink" title="项目合并统一文档"></a>项目合并统一文档</h3><p>updateAllDoc.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.interface.deleteMany(&#123;<span class="string">&quot;project_id&quot;</span>:<span class="number">20</span>&#125;);</span><br><span class="line"></span><br><span class="line">db.interface.find(&#123;<span class="string">&quot;project_id&quot;</span>:&#123;<span class="attr">$ne</span>:<span class="number">20</span>&#125;&#125;,&#123;<span class="attr">_id</span>:<span class="number">0</span>&#125;)</span><br><span class="line">   .sort(&#123;<span class="attr">title</span>:<span class="number">1</span>&#125;)</span><br><span class="line">   .forEach(<span class="function">(<span class="params">it</span>)=&gt;</span>&#123;</span><br><span class="line">     <span class="keyword">var</span>  oldCat= db.interface_cat.findOne(&#123;<span class="string">&quot;project_id&quot;</span>:it.project_id ,<span class="string">&quot;_id&quot;</span>:it.catid &#125;);</span><br><span class="line">     <span class="keyword">var</span>  newCat= db.interface_cat.findOne(&#123;<span class="string">&quot;project_id&quot;</span>:<span class="number">20</span> ,<span class="string">&quot;name&quot;</span>:oldCat.name &#125;);</span><br><span class="line">     it.project_id= <span class="number">20</span>;</span><br><span class="line">     it.catid =  newCat._id;</span><br><span class="line">     db.interface.insert(it);</span><br><span class="line">     print(it.title + <span class="string">&quot;done&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">获取mongoDB容器ID</span></span><br><span class="line">CONTAINER_ID=`docker ps --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Names&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;&quot; |grep mongo-yapi|awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">执行脚本, 将各中心的接口文档合并成一个</span></span><br><span class="line">docker cp /home/jenkins/updateAllDoc.js $CONTAINER_ID:/</span><br><span class="line">docker exec -it $CONTAINER_ID /bin/bash -c &#x27;mongo 127.0.0.1:27017/yapi updateAllDoc.js&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>文档导出长参数时结构变形</p>
<p><img src="https://raw.githubusercontent.com/guobq/mysource/master/PictureBed/yapi%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E5%AF%BC%E5%87%BA%E9%95%BF%E5%8F%82%E6%95%B0%E9%97%AE%E9%A2%98.png"></p>
<p>解决:</p>
<p>./vendors/exts/yapi-plugin-export-data/defaultTheme.css</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">td,</span><br><span class="line">th&#123;</span><br><span class="line">  border:1px solid #ddd;</span><br><span class="line">  padding:<span class="number">3</span>px <span class="number">10</span>px;</span><br><span class="line">  <span class="keyword">while</span>-space:nowrap</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></div><a class="button-hover more" href="/bq/725be948.html#more">阅读全文</a></div></div><div id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/">&lt;i class&#x3D;&quot;fas fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/">&lt;i class&#x3D;&quot;fas fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a></div></div></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fas fa-user"></i></span><span id="busuanzi_value_site_uv"></span><span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fas fa-eye"></i></span><span id="busuanzi_value_site_pv"></span><span></span></div><div class="copyright">&copy;2020 ～ 2021 By bq</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>